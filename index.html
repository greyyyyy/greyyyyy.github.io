<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/23/RNN%E5%AE%9E%E7%8E%B0%E8%BF%9E%E7%BB%AD%E6%95%B0%E6%8D%AE%E9%A2%84%E6%B5%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/23/RNN%E5%AE%9E%E7%8E%B0%E8%BF%9E%E7%BB%AD%E6%95%B0%E6%8D%AE%E9%A2%84%E6%B5%8B/" class="post-title-link" itemprop="url">RNNå®ç°è¿ç»­æ•°æ®é¢„æµ‹</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-23 19:26:44" itemprop="dateCreated datePublished" datetime="2021-02-23T19:26:44+08:00">2021-02-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-02-25 14:13:05" itemprop="dateModified" datetime="2021-02-25T14:13:05+08:00">2021-02-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>RNNï¼Œä¹Ÿå°±æ˜¯å¾ªç¯ç¥ç»ç½‘ç»œï¼Œå®ç°è¿ç»­æ•°æ®é¢„æµ‹ã€‚   </p>
<h1 id="å›é¡¾å·ç§¯ç¥ç»ç½‘ç»œ"><a href="#å›é¡¾å·ç§¯ç¥ç»ç½‘ç»œ" class="headerlink" title="å›é¡¾å·ç§¯ç¥ç»ç½‘ç»œ"></a>å›é¡¾å·ç§¯ç¥ç»ç½‘ç»œ</h1><p>å·ç§¯å°±æ˜¯ç‰¹å¾æå–å™¨ï¼Œå°±æ˜¯<code>CBAPD</code>â€”â€”â€”â€”C(å·ç§¯),B(BNï¼Œæ‰¹æ ‡å‡†åŒ–),A(æ¿€æ´»),P(æ± åŒ–),D(èˆå¼ƒ)<br>å·ç§¯ç¥ç»ç½‘ç»œï¼Œå°±æ˜¯å€ŸåŠ©å·ç§¯æ ¸æå–ç©ºé—´ç‰¹å¾åï¼Œé€å…¥å…¨è¿æ¥ç½‘ç»œã€‚<br>è€Œæœ‰äº›æ•°æ®æ˜¯å’Œç©ºé—´åºåˆ—ç›¸å…³çš„ï¼Œèƒ½å¤Ÿé€šè¿‡è¿ç»­æ€§è¿›è¡Œé¢„æµ‹ã€‚   </p>
<h1 id="å¾ªç¯æ ¸"><a href="#å¾ªç¯æ ¸" class="headerlink" title="å¾ªç¯æ ¸"></a>å¾ªç¯æ ¸</h1><p><strong>å®šä¹‰ï¼š*</strong> å‚ä¸æ—¶é—´å…±äº«ï¼Œå¾ªç¯å±‚æå–æ—¶é—´ä¿¡æ¯<br>å¾ªç¯æ ¸å…·æœ‰è®°å¿†åŠ›ï¼Œé€šè¿‡ä¸åŒæ—¶åˆ»çš„å‚æ•°å…±äº«ï¼Œå®ç°äº†å¯¹æ—¶é—´åºåˆ—çš„ä¿¡æ¯æå–<br><img src="https://i.loli.net/2021/02/23/GPWMR94uZwxF3fH.png" alt="image.png"><br>ğŸ‘†è¿™æ˜¯è®°å¿†ä½“ï¼Œå¯ä»¥è®¾å®šè®°å¿†ä½“çš„ä¸ªæ•°ï¼Œæ”¹å˜è®°å¿†å®¹é‡ï¼Œå½“è®°å¿†ä½“ä¸ªæ•°è¢«æŒ‡å®šï¼Œè¾“å…¥Xtï¼ŒYtç»´åº¦è¢«æŒ‡å®šï¼Œå‘¨å›´çš„å¾…è®­ç»ƒå‚æ•°é‡ç»´åº¦ä¹Ÿå°±è¢«é™å®šäº†ã€‚<br>è®°å¿†ä½“å†…å­˜å‚¨ç€æ¯ä¸ªæ—¶åˆ»çš„çŠ¶æ€ä¿¡æ¯htï¼Œè®°å¿†ä½“å½“å‰æ—¶åˆ»å­˜å‚¨çš„çŠ¶æ€ä¿¡æ¯<code>ht=tanh(Xt*Wxh+h(t-1)*Whh+bh)</code>,å½“å‰æ—¶åˆ»ï¼Œå¾ªç¯æ ¸çš„è¾“å‡ºç‰¹å¾<code>yt=softmax(ht*Why+by)</code>,å®é™…ä¸Šï¼Œå¾—åˆ°è¾“å‡ºçš„ytçš„è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ä¸€å±‚å…¨è¿æ¥ã€‚<br>ä¸‰ä¸ªå‚æ•°<code>Wxh,Whh,Why</code>,æ­£å¦‚<code>w,b</code>ä¸€æ ·ï¼Œåœ¨å‰å‘ä¼ æ’­æ—¶ï¼Œæ˜¯å›ºå®šä¸å˜çš„ï¼›åœ¨åå‘ä¼ æ’­æ—¶ï¼Œè¢«æ¢¯åº¦ä¸‹é™æ³•æ›´æ–°ã€‚   </p>
<h1 id="å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="å¾ªç¯ç¥ç»ç½‘ç»œ"></a>å¾ªç¯ç¥ç»ç½‘ç»œ</h1><p>å¾ªç¯æ ¸æŒ‰æ—¶é—´æ­¥å±•å¼€ï¼Œä¹Ÿå°±æ˜¯æŠŠå¾ªç¯æ ¸æŒ‰ç…§æ—¶é—´è½´æ–¹å‘å±•å¼€ã€‚<br><img src="https://i.loli.net/2021/02/23/BNpfJ8HXDwA53me.png" alt="image.png"><br>æ¯ä¸ªæ—¶åˆ»ï¼Œè®°å¿†ä½“çŠ¶æ€ä¿¡æ¯htè¢«åˆ·æ–°ï¼Œè®°å¿†ä½“å‘¨å›´çš„å‚æ•°<code>Wxh,Whh,Why</code>æ˜¯ä¸å˜çš„ï¼Œè®­ç»ƒä¼˜åŒ–çš„å¯¹è±¡å°±æ˜¯è¿™äº›å‚æ•°çŸ©é˜µ<br>è®­ç»ƒå®Œæˆåï¼Œé€‰ç”¨æ•ˆæœæœ€å¥½çš„å‚æ•°çŸ©é˜µï¼Œæ‰§è¡Œå‰å‘ä¼ æ’­ï¼Œè¾“å‡ºé¢„æµ‹ç»“æœã€‚<br>å¾ªç¯ç¥ç»ç½‘ç»œå°±æ˜¯å€ŸåŠ©å¾ªç¯æ ¸æå–æ—¶é—´ç‰¹å¾åï¼Œé€å…¥å…¨è¿æ¥ç½‘ç»œï¼Œå®ç°è¿ç»­æ•°æ®çš„é¢„æµ‹ã€‚<br><img src="https://i.loli.net/2021/02/23/MfmTOu9v2GDgU34.png" alt="image.png"></p>
<h1 id="å¾ªç¯è®¡ç®—å±‚"><a href="#å¾ªç¯è®¡ç®—å±‚" class="headerlink" title="å¾ªç¯è®¡ç®—å±‚"></a>å¾ªç¯è®¡ç®—å±‚</h1><p>æ¯ä¸ªå¾ªç¯æ ¸æ„æˆä¸€å±‚å¾ªç¯è®¡ç®—å±‚ã€‚<br>å¾ªç¯è®¡ç®—å±‚çš„å±‚æ•°æ˜¯ç€å‘è¾“å‡ºæ–¹å‘ç”Ÿé•¿çš„ã€‚<br><img src="https://i.loli.net/2021/02/23/GBPtUSpKAOcvnTo.png" alt="image.png"><br><img src="https://i.loli.net/2021/02/23/9HuhvPI86GAXeEo.png" alt="image.png"><br><img src="https://i.loli.net/2021/02/23/kEi2ZB1odtI4WUz.png" alt="image.png"><br><img src="https://i.loli.net/2021/02/23/FE1rMDqseKpLch7.png" alt="image.png"><br>å…¥RNNæ—¶ï¼Œæ˜¯æœ‰ç»´åº¦è¦æ±‚çš„ï¼Œxçš„ç»´åº¦è¦æ˜¯ä¸‰ç»´çš„<code>(é€å…¥æ ·æœ¬æ•°,å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°,æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°)</code><br><img src="https://i.loli.net/2021/02/23/ma2zvbZpFnsOUf1.png" alt="image.png">    </p>
<h1 id="ç¤ºä¾‹ï¼šå­—æ¯é¢„æµ‹"><a href="#ç¤ºä¾‹ï¼šå­—æ¯é¢„æµ‹" class="headerlink" title="ç¤ºä¾‹ï¼šå­—æ¯é¢„æµ‹"></a>ç¤ºä¾‹ï¼šå­—æ¯é¢„æµ‹</h1><p><strong>ç›®æ ‡ï¼š</strong>è¾“å…¥ä¸€ä¸ªå­—æ¯ï¼Œé¢„æµ‹å‡ºä¸‹ä¸€ä¸ªå­—æ¯ï¼›<br>é¦–å…ˆï¼Œç¥ç»ç½‘ç»œé¢„æµ‹çš„ç›´æ¥ç»“æœéƒ½æ˜¯æ•°å­—ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆæŠŠè¦ç”¨åˆ°çš„äº”ä¸ªå­—æ¯ç”¨æ•°å­—è¡¨ç¤ºå‡ºæ¥ï¼Œæˆ‘ä»¬ç”¨<code>one-hot</code>çš„æ–¹æ³•æ¥è¡¨ç¤ºã€‚<br><img src="https://i.loli.net/2021/02/23/FxyNuJk62W1P8Lr.png" alt="image.png"><br>éšæœºç”Ÿæˆä¸‰ä¸ªå‚æ•°çŸ©é˜µ<br><img src="https://i.loli.net/2021/02/23/WAi2qxGPrMuLyTU.png" alt="image.png"><br><img src="https://i.loli.net/2021/02/23/lJIna3oXAgrxK5C.png" alt="image.png"><br><img src="https://i.loli.net/2021/02/23/iOfZ8b9HsWt7Gq5.png" alt="image.png"><br>å½“å‰è¾“å…¥å­—æ¯bï¼Œä¹Ÿå°±æ˜¯<code>[0,1,0,0,0]</code>ï¼Œä¹˜ä¸Š<code>Wxh</code>,å†åŠ ä¸Šä¸Šä¸€ä¸ªçŠ¶æ€<code>ht*Whh</code>,å†åŠ ä¸Šåç½®é¡¹<br><img src="https://i.loli.net/2021/02/23/Ko8ETwgOPvRtHsI.png" alt="image.png"><br><img src="https://i.loli.net/2021/02/23/fOMgnlj8bxGurLI.png" alt="image.png">  </p>
<pre><code>import numpy as np
import tensorflow as tf
from tensorflow.keras.layers import Dense, SimpleRNN
import matplotlib.pyplot as plt
import os

input_word = &quot;abcde&quot;
w_to_id = {&apos;a&apos;: 0, &apos;b&apos;: 1, &apos;c&apos;: 2, &apos;d&apos;: 3, &apos;e&apos;: 4}  # å•è¯æ˜ å°„åˆ°æ•°å€¼idçš„è¯å…¸
id_to_onehot = {0: [1., 0., 0., 0., 0.], 1: [0., 1., 0., 0., 0.], 2: [0., 0., 1., 0., 0.], 3: [0., 0., 0., 1., 0.],
                4: [0., 0., 0., 0., 1.]}  # idç¼–ç ä¸ºone-hot

x_train = [id_to_onehot[w_to_id[&apos;a&apos;]], id_to_onehot[w_to_id[&apos;b&apos;]], id_to_onehot[w_to_id[&apos;c&apos;]],
        id_to_onehot[w_to_id[&apos;d&apos;]], id_to_onehot[w_to_id[&apos;e&apos;]]]
y_train = [w_to_id[&apos;b&apos;], w_to_id[&apos;c&apos;], w_to_id[&apos;d&apos;], w_to_id[&apos;e&apos;], w_to_id[&apos;a&apos;]]

np.random.seed(7)
np.random.shuffle(x_train)
np.random.seed(7)
np.random.shuffle(y_train)
tf.random.set_seed(7)

# ä½¿x_trainç¬¦åˆSimpleRNNè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ï¼Œ æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°]ã€‚
# æ­¤å¤„æ•´ä¸ªæ•°æ®é›†é€å…¥ï¼Œé€å…¥æ ·æœ¬æ•°ä¸ºlen(x_train)ï¼›è¾“å…¥1ä¸ªå­—æ¯å‡ºç»“æœï¼Œå¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ä¸º1; è¡¨ç¤ºä¸ºç‹¬çƒ­ç æœ‰5ä¸ªè¾“å…¥ç‰¹å¾ï¼Œæ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°ä¸º5
x_train = np.reshape(x_train, (len(x_train), 1, 5))
y_train = np.array(y_train)

model = tf.keras.Sequential([
    SimpleRNN(3),
    Dense(5, activation=&apos;softmax&apos;)
])

model.compile(optimizer=tf.keras.optimizers.Adam(0.01),
            loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
            metrics=[&apos;sparse_categorical_accuracy&apos;])

checkpoint_save_path = &quot;./checkpoint/rnn_onehot_1pre1.ckpt&quot;

if os.path.exists(checkpoint_save_path + &apos;.index&apos;):
    print(&apos;-------------load the model-----------------&apos;)
    model.load_weights(checkpoint_save_path)

cp_callback = tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,
                                                save_weights_only=True,
                                                save_best_only=True,
                                                monitor=&apos;loss&apos;)  # ç”±äºfitæ²¡æœ‰ç»™å‡ºæµ‹è¯•é›†ï¼Œä¸è®¡ç®—æµ‹è¯•é›†å‡†ç¡®ç‡ï¼Œæ ¹æ®lossï¼Œä¿å­˜æœ€ä¼˜æ¨¡å‹

history = model.fit(x_train, y_train, batch_size=32, epochs=100, callbacks=[cp_callback])

model.summary()

# print(model.trainable_variables)
file = open(&apos;./weights.txt&apos;, &apos;w&apos;)  # å‚æ•°æå–
for v in model.trainable_variables:
    file.write(str(v.name) + &apos;\n&apos;)
    file.write(str(v.shape) + &apos;\n&apos;)
    file.write(str(v.numpy()) + &apos;\n&apos;)
file.close()

###############################################    show   ###############################################

# æ˜¾ç¤ºè®­ç»ƒé›†å’ŒéªŒè¯é›†çš„accå’Œlossæ›²çº¿
acc = history.history[&apos;sparse_categorical_accuracy&apos;]
loss = history.history[&apos;loss&apos;]

plt.subplot(1, 2, 1)
plt.plot(acc, label=&apos;Training Accuracy&apos;)
plt.title(&apos;Training Accuracy&apos;)
plt.legend()

plt.subplot(1, 2, 2)
plt.plot(loss, label=&apos;Training Loss&apos;)
plt.title(&apos;Training Loss&apos;)
plt.legend()
plt.show()

############### predict #############

preNum = int(input(&quot;input the number of test alphabet:&quot;))
for i in range(preNum):
    alphabet1 = input(&quot;input test alphabet:&quot;)
    alphabet = [id_to_onehot[w_to_id[alphabet1]]]
    # ä½¿alphabetç¬¦åˆSimpleRNNè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ï¼Œ æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°]ã€‚æ­¤å¤„éªŒè¯æ•ˆæœé€å…¥äº†1ä¸ªæ ·æœ¬ï¼Œé€å…¥æ ·æœ¬æ•°ä¸º1ï¼›è¾“å…¥1ä¸ªå­—æ¯å‡ºç»“æœï¼Œæ‰€ä»¥å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ä¸º1; è¡¨ç¤ºä¸ºç‹¬çƒ­ç æœ‰5ä¸ªè¾“å…¥ç‰¹å¾ï¼Œæ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°ä¸º5
    alphabet = np.reshape(alphabet, (1, 1, 5))
    result = model.predict([alphabet])
    pred = tf.argmax(result, axis=1)
    pred = int(pred)
    tf.print(alphabet1 + &apos;-&gt;&apos; + input_word[pred])</code></pre><h1 id="ç¤ºä¾‹æ·±åŒ–"><a href="#ç¤ºä¾‹æ·±åŒ–" class="headerlink" title="ç¤ºä¾‹æ·±åŒ–"></a>ç¤ºä¾‹æ·±åŒ–</h1><p><strong>ç›®çš„:</strong>è¿ç»­è¾“å…¥å››ä¸ªå­—æ¯é¢„æµ‹ä¸‹ä¸€ä¸ªå­—æ¯ã€‚<br><img src="https://i.loli.net/2021/02/24/DfkZJi9K1cMEFvm.png" alt="image.png"><br>è®²è§£å¾ªç¯æ ¸æŒ‰æ—¶é—´å±•å¼€åï¼Œå¾ªç¯è®¡ç®—è¿‡ç¨‹<br>ä½¿ç”¨ä¸‰ä¸ªè®°å¿†ä½“<br><img src="https://i.loli.net/2021/02/24/AyKJpg2fh8BEHQz.png" alt="image.png"><br>åˆå§‹æ—¶åˆ»ï¼Œè®°å¿†ä½“å†…çš„è®°å¿†æ˜¯0<br><img src="https://i.loli.net/2021/02/24/rvMx9lQ3dtHmhfo.png" alt="image.png">      </p>
<h1 id="Embeddingç¼–ç "><a href="#Embeddingç¼–ç " class="headerlink" title="Embeddingç¼–ç "></a>Embeddingç¼–ç </h1><p><strong>Embeddingï¼š</strong>æ˜¯ä¸€ç§å•è¯ç¼–ç æ–¹æ³•ï¼Œå‘ä½ç»´å‘é‡å®ç°äº†ç¼–ç ã€‚è¿™ç§ç¼–ç é€šè¿‡ç¥ç»ç½‘ç»œè®­ç»ƒä¼˜åŒ–ï¼Œèƒ½è¡¨è¾¾å‡ºå•è¯é—´çš„ç›¸å…³æ€§ã€‚   </p>
<pre><code>âœ¨tf.keras.layers.Embedding(è¯æ±‡è¡¨å¤§å°,ç¼–ç ç»´åº¦)   
# ç¼–ç ç»´åº¦å°±æ˜¯ç”¨å‡ ä¸ªæ•°å­—è¡¨è¾¾ä¸€ä¸ªå•è¯   
# å¯¹1-100çš„æ•°å­—è¿›è¡Œç¼–ç ï¼Œä¸”ç”¨ä¸‰ä¸ªæ•°å­—æ¥è¡¨è¾¾ä¸€ä¸ªæ•°   
# tf.keras.layers.Embedding(100,3)   

# å…¥Embeddingï¼Œè¦æ±‚xçš„ç»´åº¦æ˜¯äºŒç»´   
âœ¨[é€å…¥æ ·æœ¬æ•°,å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°]    </code></pre><hr>
<p><strong>ä¸‹é¢è¿›è¡Œåˆšåˆšçš„ä¾‹å­ç”¨<code>Embedding</code>ç¼–ç å¤ç°</strong>     </p>
<pre><code># å…¥Embeddingè¦[é€å…¥æ ·æœ¬æ•°,å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°]  
# å…¥RNNè¦[æ ·æœ¬æ•°,å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°,æ ·æœ¬ç‰¹å¾æ•°]   

# 1.import   

import numpy as np  
import tensorflow as tf
from tensorflow.keras.layers import Dense,SimpleRNN,Embedding   
import matplotlib.pyplot as plt   

word = &apos;abcde&apos;  
w_to_id = {&apos;a&apos;:0;&apos;b&apos;:1;&apos;c&apos;:2;&apos;d&apos;:3;&apos;e&apos;:4}

# 2. trainã€test 
# è¾“å…¥ä¸€ä¸ªå­—æ¯å¯¹åº”è¾“å‡ºä¸‹ä¸€ä¸ªå­—æ¯ï¼Œä¹Ÿå°±æ˜¯ä¸‹ä¸€ä¸ªå­—æ¯æ˜¯ä¸Šä¸€ä¸ªå­—æ¯çš„æ ‡ç­¾   
x_train =[w_to_id[&apos;a&apos;],w_to_id[&apos;b&apos;],w_to_id[&apos;c&apos;],w_to_id[&apos;d&apos;],w_to_id[&apos;e&apos;]]
y_train =[w_to_id[&apos;b&apos;],w_to_id[&apos;c&apos;],w_to_id[&apos;d&apos;],w_to_id[&apos;e&apos;],w_to_id[&apos;a&apos;]]  

# æ‰“ä¹±é¡ºåº    
np.random.seed(7)
np.random.shuffle(x_train)   
np.random.seed(7)   
np.random.shuffle(y_train)   
tf.random.set_seed(7)    

# å‡†å¤‡å¯¹åº”ç»´åº¦   
x_train.reshape(x_train,(len(x_train),1))   
y_train = np.array(y_train)    

# 4.sequential   
model = tf.keras.Sequential([
    Embedding(5,2) #è¿™ä¸€å±‚ä¼šç”Ÿæˆä¸€ä¸ªäº”è¡Œä¸¤åˆ—çš„å¯è®­ç»ƒå‚æ•°çŸ©é˜µ
    SimpleRNN(3)  #è®¾å®šäº†å…·æœ‰ä¸‰ä¸ªè®°å¿†ä½“çš„å¾ªç¯å±‚
    Dense(5,activation=&apos;softmax&apos;)
])   

# 5.compile   
model.compile(optimizer=tf.keras.optimizer.Adam(0.01),loss=tf.keras.losses.SparseCategoricalCrossentroy(from_logits=False),metrics=[&apos;sparse_categorical_accuracy&apos;])   

checkpoint_save_path = &quot;./checkpoint/run_embedding_1pre1.ckpt&quot;

if os.path.exists(checkpoint_save_path + &apos;.index&apos;):
    print(&apos;-------------load the model-----------------&apos;)
    model.load_weights(checkpoint_save_path)

cp_callback = tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,
                                                save_weights_only=True,
                                                save_best_only=True,
                                                monitor=&apos;loss&apos;)  # ç”±äºfitæ²¡æœ‰ç»™å‡ºæµ‹è¯•é›†ï¼Œä¸è®¡ç®—æµ‹è¯•é›†å‡†ç¡®ç‡ï¼Œæ ¹æ®lossï¼Œä¿å­˜æœ€ä¼˜æ¨¡å‹

history = model.fit(x_train, y_train, batch_size=32, epochs=100, callbacks=[cp_callback])

model.summary()

# print(model.trainable_variables)
file = open(&apos;./weights.txt&apos;, &apos;w&apos;)  # å‚æ•°æå–
for v in model.trainable_variables:
    file.write(str(v.name) + &apos;\n&apos;)
    file.write(str(v.shape) + &apos;\n&apos;)
    file.write(str(v.numpy()) + &apos;\n&apos;)
file.close()

###############################################    show   ###############################################

# æ˜¾ç¤ºè®­ç»ƒé›†å’ŒéªŒè¯é›†çš„accå’Œlossæ›²çº¿
acc = history.history[&apos;sparse_categorical_accuracy&apos;]
loss = history.history[&apos;loss&apos;]

plt.subplot(1, 2, 1)
plt.plot(acc, label=&apos;Training Accuracy&apos;)
plt.title(&apos;Training Accuracy&apos;)
plt.legend()

plt.subplot(1, 2, 2)
plt.plot(loss, label=&apos;Training Loss&apos;)
plt.title(&apos;Training Loss&apos;)
plt.legend()
plt.show()

############### predict #############

preNum = int(input(&quot;input the number of test alphabet:&quot;))
for i in range(preNum):
    alphabet1 = input(&quot;input test alphabet:&quot;)
    alphabet = [w_to_id[alphabet1]]
    # ä½¿alphabetç¬¦åˆEmbeddingè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°]ã€‚
    # æ­¤å¤„éªŒè¯æ•ˆæœé€å…¥äº†1ä¸ªæ ·æœ¬ï¼Œé€å…¥æ ·æœ¬æ•°ä¸º1ï¼›è¾“å…¥1ä¸ªå­—æ¯å‡ºç»“æœï¼Œå¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ä¸º1ã€‚
    alphabet = np.reshape(alphabet, (1, 1))
    result = model.predict(alphabet)
    pred = tf.argmax(result, axis=1)
    pred = int(pred)
    tf.print(alphabet1 + &apos;-&gt;&apos; + input_word[pred])</code></pre><hr>
<p><strong>ä¸‹é¢æ·±åŒ–å¤ç°</strong><br><img src="https://i.loli.net/2021/02/24/1BZ2DPwjtLvx5Cb.png" alt="image.png">   </p>
<pre><code>import numpy as np
import tensorflow as tf
from tensorflow.keras.layers import Dense, SimpleRNN, Embedding
import matplotlib.pyplot as plt
import os

input_word = &quot;abcdefghijklmnopqrstuvwxyz&quot;
w_to_id = {&apos;a&apos;: 0, &apos;b&apos;: 1, &apos;c&apos;: 2, &apos;d&apos;: 3, &apos;e&apos;: 4,
        &apos;f&apos;: 5, &apos;g&apos;: 6, &apos;h&apos;: 7, &apos;i&apos;: 8, &apos;j&apos;: 9,
        &apos;k&apos;: 10, &apos;l&apos;: 11, &apos;m&apos;: 12, &apos;n&apos;: 13, &apos;o&apos;: 14,
        &apos;p&apos;: 15, &apos;q&apos;: 16, &apos;r&apos;: 17, &apos;s&apos;: 18, &apos;t&apos;: 19,
        &apos;u&apos;: 20, &apos;v&apos;: 21, &apos;w&apos;: 22, &apos;x&apos;: 23, &apos;y&apos;: 24, &apos;z&apos;: 25}  # å•è¯æ˜ å°„åˆ°æ•°å€¼idçš„è¯å…¸

training_set_scaled = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
                    11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
                    21, 22, 23, 24, 25]

x_train = []
y_train = []

for i in range(4, 26):
    x_train.append(training_set_scaled[i - 4:i])
    y_train.append(training_set_scaled[i])

np.random.seed(7)
np.random.shuffle(x_train)
np.random.seed(7)
np.random.shuffle(y_train)
tf.random.set_seed(7)

# ä½¿x_trainç¬¦åˆEmbeddingè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°] ï¼Œ
# æ­¤å¤„æ•´ä¸ªæ•°æ®é›†é€å…¥æ‰€ä»¥é€å…¥ï¼Œé€å…¥æ ·æœ¬æ•°ä¸ºlen(x_train)ï¼›è¾“å…¥4ä¸ªå­—æ¯å‡ºç»“æœï¼Œå¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ä¸º4ã€‚
x_train = np.reshape(x_train, (len(x_train), 4))
y_train = np.array(y_train)

model = tf.keras.Sequential([
    Embedding(26, 2),
    SimpleRNN(10),
    Dense(26, activation=&apos;softmax&apos;)
])

model.compile(optimizer=tf.keras.optimizers.Adam(0.01),
            loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
            metrics=[&apos;sparse_categorical_accuracy&apos;])

checkpoint_save_path = &quot;./checkpoint/rnn_embedding_4pre1.ckpt&quot;

if os.path.exists(checkpoint_save_path + &apos;.index&apos;):
    print(&apos;-------------load the model-----------------&apos;)
    model.load_weights(checkpoint_save_path)

cp_callback = tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,
                                                save_weights_only=True,
                                                save_best_only=True,
                                                monitor=&apos;loss&apos;)  # ç”±äºfitæ²¡æœ‰ç»™å‡ºæµ‹è¯•é›†ï¼Œä¸è®¡ç®—æµ‹è¯•é›†å‡†ç¡®ç‡ï¼Œæ ¹æ®lossï¼Œä¿å­˜æœ€ä¼˜æ¨¡å‹

history = model.fit(x_train, y_train, batch_size=32, epochs=100, callbacks=[cp_callback])

model.summary()

file = open(&apos;./weights.txt&apos;, &apos;w&apos;)  # å‚æ•°æå–
for v in model.trainable_variables:
    file.write(str(v.name) + &apos;\n&apos;)
    file.write(str(v.shape) + &apos;\n&apos;)
    file.write(str(v.numpy()) + &apos;\n&apos;)
file.close()

###############################################    show   ###############################################

# æ˜¾ç¤ºè®­ç»ƒé›†å’ŒéªŒè¯é›†çš„accå’Œlossæ›²çº¿
acc = history.history[&apos;sparse_categorical_accuracy&apos;]
loss = history.history[&apos;loss&apos;]

plt.subplot(1, 2, 1)
plt.plot(acc, label=&apos;Training Accuracy&apos;)
plt.title(&apos;Training Accuracy&apos;)
plt.legend()

plt.subplot(1, 2, 2)
plt.plot(loss, label=&apos;Training Loss&apos;)
plt.title(&apos;Training Loss&apos;)
plt.legend()
plt.show()

################# predict ##################

preNum = int(input(&quot;input the number of test alphabet:&quot;))
for i in range(preNum):
    alphabet1 = input(&quot;input test alphabet:&quot;)
    alphabet = [w_to_id[a] for a in alphabet1]
    # ä½¿alphabetç¬¦åˆEmbeddingè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ æ—¶é—´å±•å¼€æ­¥æ•°]ã€‚
    # æ­¤å¤„éªŒè¯æ•ˆæœé€å…¥äº†1ä¸ªæ ·æœ¬ï¼Œé€å…¥æ ·æœ¬æ•°ä¸º1ï¼›è¾“å…¥4ä¸ªå­—æ¯å‡ºç»“æœï¼Œå¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ä¸º4ã€‚
    alphabet = np.reshape(alphabet, (1, 4))
    result = model.predict([alphabet])
    pred = tf.argmax(result, axis=1)
    pred = int(pred)
    tf.print(alphabet1 + &apos;-&gt;&apos; + input_word[pred])</code></pre><h1 id="RNNå®ç°è‚¡ç¥¨é¢„æµ‹"><a href="#RNNå®ç°è‚¡ç¥¨é¢„æµ‹" class="headerlink" title="RNNå®ç°è‚¡ç¥¨é¢„æµ‹"></a>RNNå®ç°è‚¡ç¥¨é¢„æµ‹</h1><h2 id="æ•°æ®æº"><a href="#æ•°æ®æº" class="headerlink" title="æ•°æ®æº"></a>æ•°æ®æº</h2><p><img src="https://i.loli.net/2021/02/24/SzeoTcbw3GRMO6P.png" alt="image.png"><br>è¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨tushareæ¨¡å—ä¸‹è½½çš„SH600519è´µå·èŒ…å°æ—¥kçº¿æ•°æ®<br>åœ¨è¯¥ä¾‹ä¸­ï¼Œåªç”¨Cåˆ—çš„ï¼Œä¹Ÿå°±æ˜¯å¼€ç›˜ä»·çš„ï¼Œè¿ç»­60å¤©çš„æ•°æ®ï¼Œé¢„æµ‹ç¬¬61å¤©çš„å¼€ç›˜ä»·    </p>
<pre><code>import numpy as np
import tensorflow as tf
from tensorflow.keras.layers import Dropout, Dense, SimpleRNN
import matplotlib.pyplot as plt
import os
import pandas as pd
from sklearn.preprocessing import MinMaxScaler
from sklearn.metrics import mean_squared_error, mean_absolute_error
import math

maotai = pd.read_csv(&apos;./SH600519.csv&apos;)  # è¯»å–è‚¡ç¥¨æ–‡ä»¶

training_set = maotai.iloc[0:2426 - 300, 2:3].values  # å‰(2426-300=2126)å¤©çš„å¼€ç›˜ä»·ä½œä¸ºè®­ç»ƒé›†,è¡¨æ ¼ä»0å¼€å§‹è®¡æ•°ï¼Œ2:3 æ˜¯æå–[2:3)åˆ—ï¼Œå‰é—­åå¼€,æ•…æå–å‡ºCåˆ—å¼€ç›˜ä»·
test_set = maotai.iloc[2426 - 300:, 2:3].values  # å300å¤©çš„å¼€ç›˜ä»·ä½œä¸ºæµ‹è¯•é›†

# å½’ä¸€åŒ–
sc = MinMaxScaler(feature_range=(0, 1))  # å®šä¹‰å½’ä¸€åŒ–ï¼šå½’ä¸€åŒ–åˆ°(0ï¼Œ1)ä¹‹é—´
training_set_scaled = sc.fit_transform(training_set)  # æ±‚å¾—è®­ç»ƒé›†çš„æœ€å¤§å€¼ï¼Œæœ€å°å€¼è¿™äº›è®­ç»ƒé›†å›ºæœ‰çš„å±æ€§ï¼Œå¹¶åœ¨è®­ç»ƒé›†ä¸Šè¿›è¡Œå½’ä¸€åŒ–
test_set = sc.transform(test_set)  # åˆ©ç”¨è®­ç»ƒé›†çš„å±æ€§å¯¹æµ‹è¯•é›†è¿›è¡Œå½’ä¸€åŒ–

x_train = []
y_train = []

x_test = []
y_test = []

# æµ‹è¯•é›†ï¼šcsvè¡¨æ ¼ä¸­å‰2426-300=2126å¤©æ•°æ®
# åˆ©ç”¨forå¾ªç¯ï¼Œéå†æ•´ä¸ªè®­ç»ƒé›†ï¼Œæå–è®­ç»ƒé›†ä¸­è¿ç»­60å¤©çš„å¼€ç›˜ä»·ä½œä¸ºè¾“å…¥ç‰¹å¾x_trainï¼Œç¬¬61å¤©çš„æ•°æ®ä½œä¸ºæ ‡ç­¾ï¼Œforå¾ªç¯å…±æ„å»º2426-300-60=2066ç»„æ•°æ®ã€‚
for i in range(60, len(training_set_scaled)):
    x_train.append(training_set_scaled[i - 60:i, 0])
    y_train.append(training_set_scaled[i, 0])
# å¯¹è®­ç»ƒé›†è¿›è¡Œæ‰“ä¹±
np.random.seed(7)
np.random.shuffle(x_train)
np.random.seed(7)
np.random.shuffle(y_train)
tf.random.set_seed(7)
# å°†è®­ç»ƒé›†ç”±listæ ¼å¼å˜ä¸ºarrayæ ¼å¼
x_train, y_train = np.array(x_train), np.array(y_train)

# ä½¿x_trainç¬¦åˆRNNè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ï¼Œ æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°]ã€‚
# æ­¤å¤„æ•´ä¸ªæ•°æ®é›†é€å…¥ï¼Œé€å…¥æ ·æœ¬æ•°ä¸ºx_train.shape[0]å³2066ç»„æ•°æ®ï¼›è¾“å…¥60ä¸ªå¼€ç›˜ä»·ï¼Œé¢„æµ‹å‡ºç¬¬61å¤©çš„å¼€ç›˜ä»·ï¼Œå¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ä¸º60; æ¯ä¸ªæ—¶é—´æ­¥é€å…¥çš„ç‰¹å¾æ˜¯æŸä¸€å¤©çš„å¼€ç›˜ä»·ï¼Œåªæœ‰1ä¸ªæ•°æ®ï¼Œæ•…æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°ä¸º1
x_train = np.reshape(x_train, (x_train.shape[0], 60, 1))
# æµ‹è¯•é›†ï¼šcsvè¡¨æ ¼ä¸­å300å¤©æ•°æ®
# åˆ©ç”¨forå¾ªç¯ï¼Œéå†æ•´ä¸ªæµ‹è¯•é›†ï¼Œæå–æµ‹è¯•é›†ä¸­è¿ç»­60å¤©çš„å¼€ç›˜ä»·ä½œä¸ºè¾“å…¥ç‰¹å¾x_trainï¼Œç¬¬61å¤©çš„æ•°æ®ä½œä¸ºæ ‡ç­¾ï¼Œforå¾ªç¯å…±æ„å»º300-60=240ç»„æ•°æ®ã€‚
for i in range(60, len(test_set)):
    x_test.append(test_set[i - 60:i, 0])
    y_test.append(test_set[i, 0])
# æµ‹è¯•é›†å˜arrayå¹¶reshapeä¸ºç¬¦åˆRNNè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ï¼Œ æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°]
x_test, y_test = np.array(x_test), np.array(y_test)
x_test = np.reshape(x_test, (x_test.shape[0], 60, 1))

model = tf.keras.Sequential([
    SimpleRNN(80, return_sequences=True),
    Dropout(0.2),
    SimpleRNN(100),
    Dropout(0.2),
    Dense(1)
])

model.compile(optimizer=tf.keras.optimizers.Adam(0.001),
            loss=&apos;mean_squared_error&apos;)  # æŸå¤±å‡½æ•°ç”¨å‡æ–¹è¯¯å·®
# è¯¥åº”ç”¨åªè§‚æµ‹lossæ•°å€¼ï¼Œä¸è§‚æµ‹å‡†ç¡®ç‡ï¼Œæ‰€ä»¥åˆ å»metricsé€‰é¡¹ï¼Œä¸€ä¼šåœ¨æ¯ä¸ªepochè¿­ä»£æ˜¾ç¤ºæ—¶åªæ˜¾ç¤ºlosså€¼

checkpoint_save_path = &quot;./checkpoint/rnn_stock.ckpt&quot;

if os.path.exists(checkpoint_save_path + &apos;.index&apos;):
    print(&apos;-------------load the model-----------------&apos;)
    model.load_weights(checkpoint_save_path)

cp_callback = tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,
                                                save_weights_only=True,
                                                save_best_only=True,
                                                monitor=&apos;val_loss&apos;)

history = model.fit(x_train, y_train, batch_size=64, epochs=50, validation_data=(x_test, y_test), validation_freq=1,
                    callbacks=[cp_callback])

model.summary()

file = open(&apos;./weights.txt&apos;, &apos;w&apos;)  # å‚æ•°æå–
for v in model.trainable_variables:
    file.write(str(v.name) + &apos;\n&apos;)
    file.write(str(v.shape) + &apos;\n&apos;)
    file.write(str(v.numpy()) + &apos;\n&apos;)
file.close()

loss = history.history[&apos;loss&apos;]
val_loss = history.history[&apos;val_loss&apos;]

plt.plot(loss, label=&apos;Training Loss&apos;)
plt.plot(val_loss, label=&apos;Validation Loss&apos;)
plt.title(&apos;Training and Validation Loss&apos;)
plt.legend()
plt.show()

################## predict ######################
# æµ‹è¯•é›†è¾“å…¥æ¨¡å‹è¿›è¡Œé¢„æµ‹
predicted_stock_price = model.predict(x_test)
# å¯¹é¢„æµ‹æ•°æ®è¿˜åŸ---ä»ï¼ˆ0ï¼Œ1ï¼‰åå½’ä¸€åŒ–åˆ°åŸå§‹èŒƒå›´
predicted_stock_price = sc.inverse_transform(predicted_stock_price)
# å¯¹çœŸå®æ•°æ®è¿˜åŸ---ä»ï¼ˆ0ï¼Œ1ï¼‰åå½’ä¸€åŒ–åˆ°åŸå§‹èŒƒå›´
real_stock_price = sc.inverse_transform(test_set[60:])
# ç”»å‡ºçœŸå®æ•°æ®å’Œé¢„æµ‹æ•°æ®çš„å¯¹æ¯”æ›²çº¿
plt.plot(real_stock_price, color=&apos;red&apos;, label=&apos;MaoTai Stock Price&apos;)
plt.plot(predicted_stock_price, color=&apos;blue&apos;, label=&apos;Predicted MaoTai Stock Price&apos;)
plt.title(&apos;MaoTai Stock Price Prediction&apos;)
plt.xlabel(&apos;Time&apos;)
plt.ylabel(&apos;MaoTai Stock Price&apos;)
plt.legend()
plt.show()

##########evaluate##############
# calculate MSE å‡æ–¹è¯¯å·® ---&gt; E[(é¢„æµ‹å€¼-çœŸå®å€¼)^2] (é¢„æµ‹å€¼å‡çœŸå®å€¼æ±‚å¹³æ–¹åæ±‚å‡å€¼)
mse = mean_squared_error(predicted_stock_price, real_stock_price)
# calculate RMSE å‡æ–¹æ ¹è¯¯å·®---&gt;sqrt[MSE]    (å¯¹å‡æ–¹è¯¯å·®å¼€æ–¹)
rmse = math.sqrt(mean_squared_error(predicted_stock_price, real_stock_price))
# calculate MAE å¹³å‡ç»å¯¹è¯¯å·®-----&gt;E[|é¢„æµ‹å€¼-çœŸå®å€¼|](é¢„æµ‹å€¼å‡çœŸå®å€¼æ±‚ç»å¯¹å€¼åæ±‚å‡å€¼ï¼‰
mae = mean_absolute_error(predicted_stock_price, real_stock_price)
print(&apos;å‡æ–¹è¯¯å·®: %.6f&apos; % mse)
print(&apos;å‡æ–¹æ ¹è¯¯å·®: %.6f&apos; % rmse)
print(&apos;å¹³å‡ç»å¯¹è¯¯å·®: %.6f&apos; % mae)</code></pre><p><img src="https://i.loli.net/2021/02/24/VZBmNuoQhYUbIF5.png" alt="image.png"><br><img src="https://i.loli.net/2021/02/24/Bv5hmYe4XfAMDPd.png" alt="image.png"><br><img src="https://i.loli.net/2021/02/24/T2SuIe3LNvCF1mf.png" alt="image.png"></p>
<h1 id="ç”¨LSTMå®ç°è‚¡ç¥¨é¢„æµ‹"><a href="#ç”¨LSTMå®ç°è‚¡ç¥¨é¢„æµ‹" class="headerlink" title="ç”¨LSTMå®ç°è‚¡ç¥¨é¢„æµ‹"></a>ç”¨LSTMå®ç°è‚¡ç¥¨é¢„æµ‹</h1><h2 id="LSTMä»‹ç»"><a href="#LSTMä»‹ç»" class="headerlink" title="LSTMä»‹ç»"></a>LSTMä»‹ç»</h2><p>ä¼ ç»Ÿå¾ªç¯ç½‘ç»œRNNå¯ä»¥é€šè¿‡è®°å¿†ä½“å®ç°çŸ­æœŸè®°å¿†ï¼Œè¿›è¡Œè¿ç»­æ•°æ®çš„é¢„æµ‹ï¼Œä½†å½“è¿ç»­æ•°æ®çš„åºåˆ—å˜é•¿æ—¶ï¼Œä¼šä½¿å±•å¼€æ—¶é—´æ­¥è¿‡é•¿ï¼Œåœ¨åå‘ä¼ æ’­æ›´æ–°å‚æ•°æ—¶ï¼Œæ¢¯åº¦è¦æŒ‰ç…§æ—¶é—´æ­¥è¿ç»­ç›¸ä¹˜ï¼Œä¼šå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ã€‚<br>æ‰€ä»¥æå‡ºäº†é•¿çŸ­è®°å¿†ç½‘ç»œLSTM<br>LSTMä¸­å¼•å…¥äº†ä¸‰ä¸ªé—¨é™<br><img src="https://i.loli.net/2021/02/24/ZEYtFkfPIaJHcnB.png" alt="image.png"><br>ä¸‰ä¸ªé—¨é™ï¼Œéƒ½æ˜¯å½“å‰æ—¶åˆ»è¾“å…¥ç‰¹å¾xtå’Œä¸Šä¸ªæ—¶åˆ»çš„çŸ­æœŸè®°å¿†h(t-1)çš„å‡½æ•°ã€‚<code>Wiï¼ŒWfï¼ŒWo</code>éƒ½æ˜¯å¾…è®­ç»ƒå‚æ•°çŸ©é˜µ,<code>bi,bf,bo</code>éƒ½æ˜¯å¾…è®­ç»ƒåç½®é¡¹ï¼Œæœ€åç»è¿‡<code>sigmoid</code>æ¿€æ´»å‡½æ•°ï¼Œä½¿é—¨é™çš„èŒƒå›´åœ¨0-1ä¹‹é—´<br>ç»†èƒæ€æ˜¯<code>ä¸Šä¸ªæ—¶åˆ»çš„é•¿æœŸè®°å¿†*é—å¿˜é—¨+å½“å‰æ—¶åˆ»å½’çº³å‡ºçš„æ–°çŸ¥è¯†*è¾“å…¥é—¨</code><br>è®°å¿†ä½“ï¼ŒçŸ­æœŸè®°å¿†ï¼Œæ˜¯é•¿æœŸè®°å¿†çš„ä¸€éƒ¨åˆ†ã€‚æ˜¯ç»†èƒæ€è¿‡æ¿€æ´»å‡½æ•°<code>tanh</code>ï¼Œä¹˜ä¸Šè¾“å‡ºé—¨çš„ç»“æœ<br>å€™é€‰æ€è¡¨ç¤ºå½’çº³å‡ºçš„å¾…å­˜å…¥ç»†èƒæ€çš„æ–°çŸ¥è¯†<br><img src="https://i.loli.net/2021/02/24/wXM2PFarYDnygVt.png" alt="image.png">   </p>
<p>LSTMå°±æ˜¯æˆ‘ä»¬å¬è¯¾çš„è¿‡ç¨‹ã€‚å¦‚æœæˆ‘ä»¬å¬è¯¾æ˜¯ç”±pptæˆè¯¾ã€‚é‚£ä¹ˆæˆ‘ä»¬è„‘è¢‹é‡Œç°åœ¨è®°ä½çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬çš„é•¿æœŸè®°å¿†ï¼Œæ˜¯å½“å‰é¡µpptåˆ°ç¬¬ä¸€å¼ pptæ•´ä¸ªé•¿æœŸè®°å¿†ã€‚<br>é•¿æœŸè®°å¿†ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€éƒ¨åˆ†æ˜¯èµ·å§‹é¡µåˆ°å‰ä¸€é¡µçš„çŸ¥è¯†ä¹˜ä¸Šé—å¿˜é—¨ï¼Œä¹Ÿå°±æ˜¯å‰é¢çš„å†…å®¹åœ¨å½“å‰å‰©ä½™çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯è¿‡å»çš„è®°å¿†ã€‚å¦ä¸€éƒ¨åˆ†æ˜¯å½“å‰é¡µçš„æ–°çŸ¥è¯†ï¼Œæ˜¯å³å°†å­˜å…¥è„‘ä¸­çš„ç°åœ¨çš„è®°å¿†ã€‚<br>ç°åœ¨çš„è®°å¿†ï¼šç”±å½“å‰æ—¶åˆ»çš„è¾“å…¥<code>xt</code>å’Œä¸Šä¸€é¡µçš„çŸ­æœŸè®°å¿†ç•™å­˜<code>ht</code>å½’çº³å½¢æˆçš„æ–°çŸ¥è¯†ä¹˜ä¸Šè¾“å…¥é—¨ã€‚<br>ç°åœ¨çš„è®°å¿†å’Œè¿‡å»çš„è®°å¿†ä¸€åŒå­˜å‚¨ä¸ºé•¿æœŸè®°å¿†ã€‚<br>å½“è¿›è¡Œå¤è¿°æ—¶ï¼Œä¸å¯èƒ½ä¸€å­—ä¸è½çš„è®²å‡ºæ¥ï¼Œæˆ‘ä»¬è®²çš„æ˜¯ç•™å­˜åœ¨è„‘ä¸­çš„é•¿æœŸè®°å¿†ç»è¿‡è¾“å‡ºé—¨ç­›é€‰åçš„å†…å®¹ã€‚è¿™å°±æ˜¯è®°å¿†ä½“çš„è¾“å‡ºht<br>å½“æœ‰å¤šå±‚å¾ªç¯ç½‘ç»œæ—¶ï¼Œç¬¬äºŒå±‚çš„å¾ªç¯ç½‘ç»œçš„è¾“å…¥xtå°±æ˜¯ç¬¬ä¸€å±‚å¾ªç¯ç½‘ç»œçš„è¾“å‡ºhtã€‚è¾“å…¥ç¬¬äºŒå±‚ç½‘ç»œçš„æ˜¯ç¬¬ä¸€å±‚ç½‘ç»œæå–å‡ºæ¥çš„ç²¾åã€‚   </p>
<h2 id="LSTMçš„Tensorflowå®ç°"><a href="#LSTMçš„Tensorflowå®ç°" class="headerlink" title="LSTMçš„Tensorflowå®ç°"></a>LSTMçš„Tensorflowå®ç°</h2><p><strong>tf.keras.layers.LSTM(è®°å¿†ä½“ä¸ªæ•°,return_sequences=æ˜¯å¦è¿”å›è¾“å‡º)</strong>   </p>
<ul>
<li>return_sequences æ˜¯å¦æ¯ä¸ªæ—¶é—´æ­¥éƒ½è¾“å‡ºht   <ul>
<li>True æ¯ä¸ªæ—¶é—´è¾“å‡ºht  </li>
<li>False ä»…åœ¨æœ€åæ—¶é—´æ­¥è¾“å‡ºht(é»˜è®¤)   </li>
</ul>
</li>
</ul>
<p><strong>ğŸ±ä¸¾ä¾‹</strong>   </p>
<pre><code>model = tf.keras.Sequential([
    LSTM(80,return_sequences=True),
    Dropout(0.2)
    LSTM(100)
    Dropout(0.2)
    Dense(1)
])   </code></pre><h2 id="LSTMå®ç°è‚¡ç¥¨é¢„æµ‹"><a href="#LSTMå®ç°è‚¡ç¥¨é¢„æµ‹" class="headerlink" title="LSTMå®ç°è‚¡ç¥¨é¢„æµ‹"></a>LSTMå®ç°è‚¡ç¥¨é¢„æµ‹</h2><p>åªéœ€æ”¹åŠ¨   </p>
<ul>
<li>importéƒ¨åˆ†ï¼Œä¸å†import SimpleRNN    </li>
<li>modeléƒ¨åˆ†æ”¹æˆä¸Šé¢çš„æ ·å­å³å¯    </li>
</ul>
<h1 id="GRUå®ç°è‚¡ç¥¨é¢„æµ‹"><a href="#GRUå®ç°è‚¡ç¥¨é¢„æµ‹" class="headerlink" title="GRUå®ç°è‚¡ç¥¨é¢„æµ‹"></a>GRUå®ç°è‚¡ç¥¨é¢„æµ‹</h1><h2 id="GRUä»‹ç»"><a href="#GRUä»‹ç»" class="headerlink" title="GRUä»‹ç»"></a>GRUä»‹ç»</h2><p>GRUä½¿è®°å¿†ä½“htèåˆäº†é•¿æœŸè®°å¿†å’ŒçŸ­æœŸè®°å¿†ã€‚<br><img src="https://i.loli.net/2021/02/24/AMeZoga72HpNWvB.png" alt="image.png"></p>
<p>æ›´æ–°é—¨å’Œé‡ç½®é—¨éƒ½æ˜¯0-1.<br>å‰å‘ä¼ æ’­æ—¶ï¼Œæ˜¯è®¡ç®—çš„è®°å¿†ä½“è®¡ç®—å…¬å¼ï¼Œè®¡ç®—å‡ºæ¯ä¸ªæ—¶åˆ»çš„htå€¼</p>
<h2 id="TFæè¿°GRUå±‚"><a href="#TFæè¿°GRUå±‚" class="headerlink" title="TFæè¿°GRUå±‚"></a>TFæè¿°GRUå±‚</h2><p><strong>tf.keras.layers.GRU(è®°å¿†ä½“ä¸ªæ•°,return_sequences=æ˜¯å¦è¿”å›è¾“å‡º)</strong>   </p>
<ul>
<li>return_sequences é»˜è®¤False<br>  ä¸€èˆ¬æœ€åä¸€å±‚æ˜¯Falseï¼Œä¸­é—´å±‚æ˜¯True</li>
</ul>
<p><img src="https://i.loli.net/2021/02/24/8v3BRiqxdUwZWEn.png" alt="image.png">   </p>
<h2 id="GRUå®ç°è‚¡ç¥¨é¢„æµ‹-1"><a href="#GRUå®ç°è‚¡ç¥¨é¢„æµ‹-1" class="headerlink" title="GRUå®ç°è‚¡ç¥¨é¢„æµ‹"></a>GRUå®ç°è‚¡ç¥¨é¢„æµ‹</h2><p>åŒLSTM,åªéœ€æ›´æ”¹   </p>
<ul>
<li>import æ”¹ä¸º  GRU  </li>
<li>model å¤„æ”¹ä¸ºä¸Šå›¾ä»£ç   </li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/22/%E7%BB%8F%E5%85%B8%E5%8D%B7%E7%A7%AF%E7%BD%91%E7%BB%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/22/%E7%BB%8F%E5%85%B8%E5%8D%B7%E7%A7%AF%E7%BD%91%E7%BB%9C/" class="post-title-link" itemprop="url">ç»å…¸å·ç§¯ç½‘ç»œ</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-22 20:31:28" itemprop="dateCreated datePublished" datetime="2021-02-22T20:31:28+08:00">2021-02-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-02-23 19:22:13" itemprop="dateModified" datetime="2021-02-23T19:22:13+08:00">2021-02-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="LeNet"><a href="#LeNet" class="headerlink" title="LeNet"></a>LeNet</h1><p>é€šè¿‡å…±äº«å·ç§¯æ ¸å‡å°‘äº†ç½‘ç»œçš„å‚æ•°<br>åœ¨ç»Ÿè®¡å·ç§¯ç¥ç»ç½‘ç»œå±‚æ•°æ—¶ï¼Œä¸€èˆ¬åªç»Ÿè®¡å·ç§¯è®¡ç®—å±‚å’Œå…¨è¿æ¥å±‚<br>LeNetä¸€å…±æœ‰äº”å±‚ç½‘ç»œ<br>ä¸¤å±‚å·ç§¯ã€ä¸‰å±‚è¿ç»­çš„å…¨è¿æ¥    </p>
<ul>
<li>å·ç§¯å±‚1<ul>
<li>C(æ ¸:6<em>5</em>5,æ­¥é•¿ï¼š1ï¼Œå¡«å……ï¼švalid)</li>
<li>B(None)</li>
<li>A(sigmoid)</li>
<li>P(max,æ ¸:2*2,æ­¥é•¿:2,å¡«å……:valid)</li>
<li>D(None)</li>
</ul>
</li>
<li>å·ç§¯å±‚2<ul>
<li>C(æ ¸:16<em>5</em>5,æ­¥é•¿ï¼š1ï¼Œå¡«å……ï¼švalid)</li>
<li>B(None)</li>
<li>A(sigmoid)</li>
<li>P(max,æ ¸:2*2,æ­¥é•¿:2,å¡«å……:valid)</li>
<li>D(None)</li>
</ul>
</li>
<li>å…¨è¿æ¥å±‚<ul>
<li>Flatten</li>
<li>Dense(ç¥ç»å…ƒ:120, æ¿€æ´»:sigmoid)</li>
<li>Dense(ç¥ç»å…ƒ:84, æ¿€æ´»:sigmoid)</li>
<li>Dense(ç¥ç»å…ƒ:10, æ¿€æ´»:softmax)   </li>
</ul>
</li>
</ul>
<pre><code>class LeNet5(Model):
    def __init__(self):
        super(LeNet5, self).__init__()
        self.c1 = Conv2D(filters=6, kernel_size=(5, 5),
                        activation=&apos;sigmoid&apos;)
        self.p1 = MaxPool2D(pool_size=(2, 2), strides=2)

        self.c2 = Conv2D(filters=16, kernel_size=(5, 5),
                        activation=&apos;sigmoid&apos;)
        self.p2 = MaxPool2D(pool_size=(2, 2), strides=2)

        self.flatten = Flatten()
        self.f1 = Dense(120, activation=&apos;sigmoid&apos;)
        self.f2 = Dense(84, activation=&apos;sigmoid&apos;)
        self.f3 = Dense(10, activation=&apos;softmax&apos;)

    def call(self, x):
        x = self.c1(x)
        x = self.p1(x)

        x = self.c2(x)
        x = self.p2(x)

        x = self.flatten(x)
        x = self.f1(x)
        x = self.f2(x)
        y = self.f3(x)
        return y


model = LeNet5()</code></pre><h1 id="AlexNet"><a href="#AlexNet" class="headerlink" title="AlexNet"></a>AlexNet</h1><p>ä½¿ç”¨æ¿€æ´»å‡½æ•°<code>relu</code>ï¼Œæå‡äº†è®­ç»ƒé€Ÿåº¦<br>ä½¿ç”¨<code>Dropout</code>ï¼Œç¼“è§£äº†è¿‡æ‹Ÿåˆ<br>AlexNetä¸€å…±æœ‰å…«å±‚<br>äº”å±‚å·ç§¯ï¼Œä¸‰å±‚å…¨è¿æ¥   </p>
<ul>
<li><p>å·ç§¯å±‚1</p>
<ul>
<li>C(æ ¸:96<em>3</em>3,æ­¥é•¿ï¼š1ï¼Œå¡«å……ï¼švalid)</li>
<li>B(Yes,LRN)  # LRNæ˜¯å±€éƒ¨å“åº”æ ‡å‡†åŒ–ï¼Œè¿‘å¹´ä½¿ç”¨å°‘</li>
<li>A(relu)  </li>
<li>P(max,æ ¸:3*3,æ­¥é•¿:2)</li>
<li>D(None)</li>
</ul>
</li>
<li><p>å·ç§¯å±‚2</p>
<ul>
<li>C(æ ¸:256<em>3</em>3,æ­¥é•¿ï¼š1ï¼Œå¡«å……ï¼švalid)</li>
<li>B(Yes,LRN)  # LRNæ˜¯å±€éƒ¨å“åº”æ ‡å‡†åŒ–ï¼Œè¿‘å¹´ä½¿ç”¨å°‘</li>
<li>A(relu)  </li>
<li>P(max,æ ¸:3*3,æ­¥é•¿:2)</li>
<li>D(None)</li>
</ul>
</li>
<li><p>å·ç§¯å±‚3</p>
<ul>
<li>C(æ ¸:384<em>3</em>3,æ­¥é•¿ï¼š1ï¼Œå¡«å……ï¼šsame)</li>
<li>B(None)</li>
<li>A(relu)  </li>
<li>P(None)</li>
<li>D(None)</li>
</ul>
</li>
<li><p>å·ç§¯å±‚4</p>
<ul>
<li>C(æ ¸:384<em>3</em>3,æ­¥é•¿ï¼š1ï¼Œå¡«å……ï¼šsame)</li>
<li>B(None)</li>
<li>A(relu)  </li>
<li>P(None)</li>
<li>D(None)</li>
</ul>
</li>
<li><p>å·ç§¯å±‚5</p>
<ul>
<li>C(æ ¸:256<em>3</em>3,æ­¥é•¿ï¼š1ï¼Œå¡«å……ï¼šsame)</li>
<li>B(None)</li>
<li>A(relu)  </li>
<li>P(max,æ ¸:3*3,æ­¥é•¿:2)</li>
<li>D(None)</li>
</ul>
</li>
<li><p>å…¨è¿æ¥å±‚   </p>
<ul>
<li><p>Flatten</p>
</li>
<li><p>Dense(ç¥ç»å…ƒ:2048,æ¿€æ´»:relu,Dropout:0.5)</p>
</li>
<li><p>Dense(ç¥ç»å…ƒ:2048,æ¿€æ´»:relu,Dropout:0.5)</p>
</li>
<li><p>Dense(ç¥ç»å…ƒ:10,æ¿€æ´»:softmax)   </p>
<pre><code>class AlexNet8(Model):
    def __init__(self):
        super(AlexNet8, self).__init__()
        self.c1 = Conv2D(filters=96, kernel_size=(3, 3))
        self.b1 = BatchNormalization()
        self.a1 = Activation(&apos;relu&apos;)
        self.p1 = MaxPool2D(pool_size=(3, 3), strides=2)

        self.c2 = Conv2D(filters=256, kernel_size=(3, 3))
        self.b2 = BatchNormalization()
        self.a2 = Activation(&apos;relu&apos;)
        self.p2 = MaxPool2D(pool_size=(3, 3), strides=2)

        self.c3 = Conv2D(filters=384, kernel_size=(3, 3), padding=&apos;same&apos;,
                        activation=&apos;relu&apos;)

        self.c4 = Conv2D(filters=384, kernel_size=(3, 3), padding=&apos;same&apos;,
                        activation=&apos;relu&apos;)

        self.c5 = Conv2D(filters=256, kernel_size=(3, 3), padding=&apos;same&apos;,
                        activation=&apos;relu&apos;)
        self.p3 = MaxPool2D(pool_size=(3, 3), strides=2)

        self.flatten = Flatten()
        self.f1 = Dense(2048, activation=&apos;relu&apos;)
        self.d1 = Dropout(0.5)
        self.f2 = Dense(2048, activation=&apos;relu&apos;)
        self.d2 = Dropout(0.5)
        self.f3 = Dense(10, activation=&apos;softmax&apos;)

    def call(self, x):
        x = self.c1(x)
        x = self.b1(x)
        x = self.a1(x)
        x = self.p1(x)

        x = self.c2(x)
        x = self.b2(x)
        x = self.a2(x)
        x = self.p2(x)

        x = self.c3(x)

        x = self.c4(x)

        x = self.c5(x)
        x = self.p3(x)

        x = self.flatten(x)
        x = self.f1(x)
        x = self.d1(x)
        x = self.f2(x)
        x = self.d2(x)
        y = self.f3(x)
        return y</code></pre></li>
</ul>
</li>
</ul>
<pre><code>model = AlexNet8()    </code></pre><h1 id="VGGNet"><a href="#VGGNet" class="headerlink" title="VGGNet"></a>VGGNet</h1><p><img src="https://i.loli.net/2021/02/22/jwRvAmQIEqTLlX5.png" alt="image.png"></p>
<h1 id="InceptionNet"><a href="#InceptionNet" class="headerlink" title="InceptionNet"></a>InceptionNet</h1><p>InceptionNetå¼•å…¥äº†Inceptionç»“æ„å—<br>åœ¨åŒä¸€å±‚ç½‘ç»œå†…ä½¿ç”¨ä¸åŒå°ºå¯¸çš„å·ç§¯æ ¸ï¼Œæå‡äº†æ¨¡å‹æ„ŸçŸ¥åŠ›<br>ä½¿ç”¨äº†æ‰¹æ ‡å‡†åŒ–ï¼Œç¼“è§£äº†æ¢¯åº¦æ¶ˆå¤±<br><img src="https://i.loli.net/2021/02/22/1yXFTZmadBczhPA.png" alt="image.png"><br>Inceptionç»“æ„å—åœ¨åŒä¸€å±‚ç½‘ç»œä¸­ä½¿ç”¨äº†å¤šä¸ªå°ºå¯¸çš„å·ç§¯æ ¸ï¼Œå¯ä»¥æå–ä¸åŒå°ºå¯¸çš„ç‰¹å¾<br>é€šè¿‡<code>1*1</code>å·ç§¯æ ¸ä½œç”¨åˆ°è¾“å…¥ç‰¹å¾çš„æ¯ä¸ªåƒç´ ç‚¹ï¼Œé€šè¿‡è®¾å®šå°‘äºè¾“å…¥ç‰¹å¾å›¾æ·±åº¦çš„<code>1*1</code>å·ç§¯æ ¸ä¸ªæ•°ï¼Œå‡å°‘äº†è¾“å‡ºç‰¹å¾å›¾æ·±åº¦ï¼Œèµ·åˆ°äº†é™ç»´çš„ä½œç”¨ï¼Œå‡å°‘äº†å‚æ•°é‡æ ¸è®¡ç®—é‡<br>Inceptionç»“æ„å—åŒ…å«å››ä¸ªåˆ†æ”¯ï¼Œåˆ†åˆ«</p>
<ul>
<li>ç»è¿‡<code>1*1</code>å·ç§¯æ ¸è¾“å‡ºåˆ°å·ç§¯è¿æ¥å™¨ï¼›</li>
<li>ç»è¿‡<code>1*1</code>å·ç§¯æ ¸é…åˆ<code>3*3</code>å·ç§¯æ ¸è¾“å‡ºåˆ°å·ç§¯è¿æ¥å™¨ï¼›</li>
<li>ç»è¿‡<code>1*1</code>å·ç§¯æ ¸é…åˆ<code>5*5</code>å·ç§¯æ ¸è¾“å‡ºåˆ°å·ç§¯è¿æ¥å™¨ï¼›</li>
<li>ç»è¿‡<code>3*3</code>æœ€å¤§æ± åŒ–æ ¸é…åˆ<code>1*1</code>å·ç§¯æ ¸è¾“å‡ºåˆ°å·ç§¯è¿æ¥å™¨ï¼›  </li>
</ul>
<p>é€åˆ°å·ç§¯è¿æ¥å™¨çš„ç‰¹å¾æ•°æ®å°ºå¯¸ç›¸åŒ<br>å·ç§¯è¿æ¥å™¨ä¼šæŠŠæ”¶åˆ°çš„è¿™å››è·¯ç‰¹å¾æ•°æ®æŒ‰æ·±åº¦æ–¹å‘æ‹¼æ¥ï¼Œå½¢æˆInceptionç»“æ„å—çš„è¾“å‡º<br>ç”±äºInceptionç»“æ„å—ä¸­çš„å·ç§¯æ“ä½œå‡é‡‡ç”¨äº†å…ˆå·ç§¯ï¼Œå†BNï¼Œå†reluæ¿€æ´»å‡½æ•°(CBA),åˆ™å®šä¹‰ä¸ºä¸€ä¸ªæ–°çš„ç±»ConvBNRelu   </p>
<pre><code>class ConvBNRelu(Model):
    def __init__(self, ch, kernelsz=3, strides=1, padding=&apos;same&apos;):
        super(ConvBNRelu, self).__init__()
        self.model = tf.keras.models.Sequential([
            Conv2D(ch, kernelsz, strides=strides, padding=padding),
            BatchNormalization(),
            Activation(&apos;relu&apos;)
        ])

    def call(self, x):
        x = self.model(x, training=False) #åœ¨training=Falseæ—¶ï¼ŒBNé€šè¿‡æ•´ä¸ªè®­ç»ƒé›†è®¡ç®—å‡å€¼ã€æ–¹å·®å»åšæ‰¹å½’ä¸€åŒ–ï¼Œtraining=Trueæ—¶ï¼Œé€šè¿‡å½“å‰batchçš„å‡å€¼ã€æ–¹å·®å»åšæ‰¹å½’ä¸€åŒ–ã€‚æ¨ç†æ—¶ training=Falseæ•ˆæœå¥½
        return x 
class InceptionBlk(Model):
    def __init__(self, ch, strides=1):
        super(InceptionBlk, self).__init__()
        self.ch = ch
        self.strides = strides
        self.c1 = ConvBNRelu(ch, kernelsz=1, strides=strides)  # ç¬¬ä¸€ä¸ªåˆ†æ”¯
        self.c2_1 = ConvBNRelu(ch, kernelsz=1, strides=strides) #ç¬¬äºŒä¸ªåˆ†æ”¯çš„ç¬¬ä¸€ä¸ªå·ç§¯æ ¸
        self.c2_2 = ConvBNRelu(ch, kernelsz=3, strides=1)       #ç¬¬äºŒä¸ªåˆ†æ”¯çš„ç¬¬äºŒä¸ªå·ç§¯æ ¸
        self.c3_1 = ConvBNRelu(ch, kernelsz=1, strides=strides)     #ä»¥æ­¤ç±»æ¨
        self.c3_2 = ConvBNRelu(ch, kernelsz=5, strides=1)
        self.p4_1 = MaxPool2D(3, strides=1, padding=&apos;same&apos;)
        self.c4_2 = ConvBNRelu(ch, kernelsz=1, strides=strides)

    def call(self, x):
        # x1,x2_2,x3_2,x4_2 æ˜¯å››ä¸ªåˆ†æ”¯çš„è¾“å‡º
        x1 = self.c1(x)
        x2_1 = self.c2_1(x)
        x2_2 = self.c2_2(x2_1)
        x3_1 = self.c3_1(x)
        x3_2 = self.c3_2(x3_1)
        x4_1 = self.p4_1(x)
        x4_2 = self.c4_2(x4_1)
        # concat along axis=channel             
        x = tf.concat([x1, x2_2, x3_2, x4_2], axis=3)      #ä½¿ç”¨è¯¥å‡½æ•°å°†ä»–ä»¬å †å åœ¨ä¸€èµ·ï¼Œaxis=3æŒ‡å®šå †å çš„ç»´åº¦æ˜¯æ²¿æ·±åº¦æ–¹å‘
        return x


    class Inception10(Model):
        def __init__(self, num_blocks, num_classes, init_ch=16, **kwargs):
            super(Inception10, self).__init__(**kwargs)
            self.in_channels = init_ch
            self.out_channels = init_ch
            self.num_blocks = num_blocks
            self.init_ch = init_ch
            self.c1 = ConvBNRelu(init_ch)
            self.blocks = tf.keras.models.Sequential()
            for block_id in range(num_blocks):
                for layer_id in range(2):
                    if layer_id == 0:
                        block = InceptionBlk(self.out_channels, strides=2)
                    else:
                        block = InceptionBlk(self.out_channels, strides=1)
                    self.blocks.add(block)
                # enlarger out_channels per block
                self.out_channels *= 2
            self.p1 = GlobalAveragePooling2D()
            self.f1 = Dense(num_classes, activation=&apos;softmax&apos;)

        def call(self, x):
            x = self.c1(x)
            x = self.blocks(x)
            x = self.p1(x)
            y = self.f1(x)
            return y</code></pre><h1 id="ResNet"><a href="#ResNet" class="headerlink" title="ResNet"></a>ResNet</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/22/Cifar10%E6%95%B0%E6%8D%AE%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/22/Cifar10%E6%95%B0%E6%8D%AE%E9%9B%86/" class="post-title-link" itemprop="url">Cifar10æ•°æ®é›†</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-02-22 19:25:50 / Modified: 20:30:31" itemprop="dateCreated datePublished" datetime="2021-02-22T19:25:50+08:00">2021-02-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <hr>
<p>title: Cifar10æ•°æ®é›†<br>date: 2021-02-22 19:25:50<br>tags:</p>
<hr>
<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>Cifar10æ•°æ®é›†ï¼š    </p>
<ul>
<li>5ä¸‡å¼ 32*32åƒç´ ç‚¹çš„ååˆ†ç±»å½©è‰²å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºè®­ç»ƒ    </li>
<li>1ä¸‡å¼ 32*32åƒç´ ç‚¹çš„ååˆ†ç±»å½©è‰²å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºæµ‹è¯•   </li>
</ul>
<p><img src="https://i.loli.net/2021/02/22/DNhYKurdJsQwvCq.png" alt="image.png"><br>è¿™åä¸ªç±»åˆ«åˆ†åˆ«å¯¹åº”æ ‡ç­¾0ã€1ã€3ã€4ã€5ã€6ã€7ã€8ã€9    </p>
<pre><code># æŸ¥çœ‹æ•°æ®é›†é‡Œçš„å›¾ç‰‡
# ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„è¾“å…¥x     

plt.imshow(x_train[0])  
plt.show()    


# è¾“å…¥å›¾ç‰‡è¡¨è¾¾ä¸ºåƒç´ çŸ©é˜µ   
&gt; x_train[0]
# æ˜¯ä¸€ä¸ª(32,32,3),ä¸‰é€šé“çš„ä¸‰ç»´æ•°ç»„ 
&gt; x_test.shape
# (10000,32,32,3)

&gt; y_train[0]
...
6

# è¿™åº”è¯¥ç®—æ˜¯ç´¢å¼•å€¼ä¸º6ï¼Œyåº”è¯¥è¦æœ‰ä¸€ä¸ªå¯¹åº”çš„åˆ—è¡¨å³å¯    </code></pre><h1 id="æ­å»ºå·ç§¯ç½‘ç»œç¤ºä¾‹"><a href="#æ­å»ºå·ç§¯ç½‘ç»œç¤ºä¾‹" class="headerlink" title="æ­å»ºå·ç§¯ç½‘ç»œç¤ºä¾‹"></a>æ­å»ºå·ç§¯ç½‘ç»œç¤ºä¾‹</h1><ul>
<li><p>6ä¸ª5*5çš„å·ç§¯å±‚   </p>
</li>
<li><p>2ä¸ª2*2çš„æ± åŒ–å±‚    </p>
</li>
<li><p>ä¸¤ä¸ªéšè—å±‚   </p>
<ul>
<li>ç¬¬ä¸€ä¸ª128ä¸ªç¥ç»å…ƒ   </li>
<li>ç¬¬äºŒä¸ª10ä¸ª(ä¸è¾“å‡ºå¯¹åº”)   </li>
</ul>
</li>
</ul>
<pre><code># Cå·ç§¯(Convolutional)   
Conv2D(filters=6,kernel_size=(5,5),padding=&apos;same&apos;),

# Bæ‰¹æ ‡å‡†åŒ–(BN)  
BatchNormalization(),

# Aæ¿€æ´»(Activation)   
Actication(&apos;relu&apos;),   

# Pæ± åŒ–(Pooling)   
MaxPool2D(pool_size=(2,2),strides=2,padding=&apos;same&apos;),

# Dèˆå¼ƒ(Dropout)   
Dropout(0.2)   </code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/22/%E5%8D%B7%E7%A7%AF%E7%BD%91%E7%BB%9C%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/22/%E5%8D%B7%E7%A7%AF%E7%BD%91%E7%BB%9C%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">å·ç§¯ç½‘ç»œæ­å»º</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-02-22 14:03:08 / Modified: 17:16:56" itemprop="dateCreated datePublished" datetime="2021-02-22T14:03:08+08:00">2021-02-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å·ç§¯è®¡ç®—è¿‡ç¨‹"><a href="#å·ç§¯è®¡ç®—è¿‡ç¨‹" class="headerlink" title="å·ç§¯è®¡ç®—è¿‡ç¨‹"></a>å·ç§¯è®¡ç®—è¿‡ç¨‹</h1><p>å…¨è¿æ¥ç½‘ç»œ(ä¹Ÿå†™ä½œï¼šå…¨è¿æ¥NN)ä¸­æ¯ä¸€ä¸ªç¥ç»å…ƒå°çƒä¸å‰åç›¸é‚»å±‚çš„æ¯ä¸€ä¸ªç¥ç»å…ƒéƒ½æœ‰è¿æ¥å…³ç³»ï¼Œè¾“å…¥æ˜¯ç‰¹å¾ï¼Œè¾“å‡ºæ˜¯é¢„æµ‹çš„ç»“æœ<br>å½“ç½‘ç»œå‚æ•°è¿‡å¤šï¼Œéšè—å±‚æ•°å¢åŠ ï¼Œå¾ˆå®¹æ˜“ä½¿æ¨¡å‹è¿‡æ‹Ÿåˆã€‚<br>ä¸ºäº†å‡å°‘å¾…è®­ç»ƒå‚æ•°ï¼Œåˆ™å…ˆå¯¹åŸå§‹å›¾ç‰‡è¿›è¡Œç‰¹å¾æå–ï¼Œå†æŠŠæå–åˆ°çš„ç‰¹å¾é€åˆ°å…¨è¿æ¥ç½‘ç»œï¼Œè®©å…¨è¿æ¥ç½‘ç»œè¾“å‡ºè¯†åˆ«ç»“æœ   </p>
<p><strong>å·ç§¯è®¡ç®—æ˜¯ä¸€ç§æœ‰æ•ˆçš„ç‰¹å¾æå–æ–¹æ³•</strong><br>ä¸€èˆ¬ç”¨ä¸€ä¸ªæ­£æ–¹å½¢çš„å·ç§¯æ ¸ï¼ŒæŒ‰æŒ‡å®šæ­¥é•¿ï¼Œåœ¨è¾“å…¥ç‰¹å¾å›¾ä¸Šæ»‘åŠ¨ï¼Œéå†è¾“å…¥ç‰¹å¾å›¾ä¸­çš„æ¯ä¸ªåƒç´ ç‚¹ã€‚æ¯ä¸€ä¸ªæ­¥é•¿ï¼Œå·ç§¯æ ¸ä¼šä¸è¾“å…¥ç‰¹å¾å›¾å‡ºç°é‡åˆåŒºåŸŸï¼Œé‡åˆåŒºåŸŸå¯¹åº”å…ƒç´ ç›¸ä¹˜ã€æ±‚å’Œå†åŠ ä¸Šåç½®é¡¹ï¼Œå¾—åˆ°è¾“å‡ºç‰¹å¾çš„ä¸€ä¸ªåƒç´ ç‚¹ã€‚<br><img src="https://i.loli.net/2021/02/22/TBMPohCsjU3ZNAF.png" alt="image.png">    </p>
<p><strong>ğŸ±è¡¥å……</strong>   </p>
<ul>
<li>å›¾åƒçš„æ·±åº¦<br>å›¾åƒæ˜¯ç”±ä¸€ä¸ªä¸ªåƒç´ ç‚¹æ„æˆï¼Œè€Œè®¡ç®—æœºæ˜¯ç”¨äºŒè¿›åˆ¶æ¥è¿›è¡Œå‚¨å­˜ï¼Œæ¯ä¸€ä¸ªåƒç´ ç‚¹æ‰€å ç”¨çš„bitä½æ•°ï¼Œå°±æ˜¯å›¾åƒçš„æ·±åº¦ã€‚   <ul>
<li>äºŒå€¼å›¾åƒ<br>åƒç´ ç‚¹å–å€¼ä¸º0æˆ–1ï¼Œä¹Ÿå°±æ˜¯é»‘ç™½ä¸¤è‰².åƒç´ ç‚¹æ‰€å ä½æ•°ä¸º1ä½ï¼Œåˆ™æ·±åº¦ä¸º1  </li>
<li>ç°åº¦å›¾åƒ<br>åƒç´ ç‚¹å–å€¼ä¸º0-255ï¼Œ2^8=256ï¼Œæ‰€ä»¥æ·±åº¦æ˜¯8   </li>
</ul>
</li>
<li>å›¾åƒçš„é€šé“<br>24ä½å›¾ï¼Œä¹Ÿå°±æ˜¯2^24ï¼Œæˆ‘ä»¬ç”¨8ä½ä»£è¡¨ä¸€ç§é¢œè‰²ï¼Œé‚£ä¹ˆæ¯ä¸€ç§é¢œè‰²éƒ½æ˜¯0-255çš„èŒƒå›´å†…ï¼Œæ¯ä¸€ä¸ªåƒç´ ç‚¹ä¸º(0-255,0-255,0-255),è¿™å°±æ˜¯ä¸‰é€šé“RGB    </li>
</ul>
<p><strong>å·ç§¯æ ¸çš„é€šé“æ•°ä¸è¾“å…¥ç‰¹å¾å›¾çš„é€šé“æ•°ä¸€è‡´</strong><br>å¦‚æœè¾“å…¥ç‰¹å¾æ˜¯å•é€šé“ç°å›¾ï¼Œç”¨æ·±åº¦ä¸º1çš„å•é€šé“å·ç§¯æ ¸<br>å¦‚æœè¾“å…¥ç‰¹å¾æ˜¯ä¸‰é€šé“å½©è‰²å›¾ï¼Œç”¨3<em>3</em>3çš„å·ç§¯æ ¸æˆ–5<em>5</em>3çš„å·ç§¯æ ¸<br>è¦æƒ³è®©å·ç§¯æ ¸ä¸è¾“å…¥ç‰¹å¾å›¾å¯¹åº”ç‚¹åŒ¹é…ä¸Šï¼Œå¿…é¡»è®©å·ç§¯æ ¸çš„æ·±åº¦ä¸è¾“å…¥ç‰¹å¾å›¾çš„æ·±åº¦ä¸€è‡´<br><strong>è¾“å…¥ç‰¹å¾å›¾çš„æ·±åº¦(channelæ•°),å†³å®šäº†å½“å‰å±‚å·ç§¯æ ¸çš„æ·±åº¦:</strong><br>(ä¸Šè¿°åŠ ç²—çš„å°±æ˜¯åŸæ–‡çš„è¡¨è¿°ï¼Œæˆ‘è§‰å¾—åº”è¯¥ä¸æ˜¯æŒ‡å›¾åƒçš„æ·±åº¦ï¼Œå› è¯¥æ˜¯å›¾åƒçš„é€šé“æ•°)<br>æ¯ä¸ªå·ç§¯æ ¸åœ¨å·ç§¯è®¡ç®—åä¼šå¾—åˆ°ä¸€å¼ è¾“å‡ºç‰¹å¾å›¾ï¼Œæ‰€ä»¥å½“å‰æœ‰å‡ ä¸ªå·ç§¯æ ¸ï¼Œå°±æœ‰å‡ å¼ è¾“å‡ºç‰¹å¾å›¾ã€‚<br><strong>å½“å‰å±‚å·ç§¯æ ¸çš„ä¸ªæ•°ï¼Œå†³å®šäº†å½“å‰å±‚è¾“å‡ºç‰¹å¾å›¾çš„æ·±åº¦</strong><br>å¯ä»¥é€šè¿‡å¤šç”¨å‡ ä¸ªå·ç§¯æ ¸æé«˜è¯¥å±‚çš„ç‰¹å¾æå–èƒ½åŠ›<br><img src="https://i.loli.net/2021/02/22/jZkKz6gTyHlE5MQ.png" alt="image.png">  </p>
<p>æ¯ä¸€ä¸ªå°é¢—ç²’éƒ½å­˜å‚¨ç€å¾…è®­ç»ƒå‚æ•°ï¼Œåœ¨æ‰§è¡Œå·ç§¯è®¡ç®—æ—¶ï¼Œè¿™äº›å‚æ•°æ˜¯ä¸å˜çš„ã€‚è€Œåœ¨åå‘ä¼ æ’­ä¸­ï¼Œè¿™äº›å‚æ•°æ˜¯éšç€æ¢¯åº¦ä¸‹é™è·Ÿæ–°çš„<br>å·ç§¯å°±æ˜¯åˆ©ç”¨ç«‹ä½“å·ç§¯æ ¸å®ç°äº†å‚æ•°çš„ç©ºé—´å…±äº«    </p>
<blockquote>
<p>You can imagine convolution as the mixing of information. Imagine two buckets full of information which are poured into one single bucket and then mixed according to a specific rule. Each bucket of information has its own recipe, which describes how the information in one bucket mixes with the other. So convolution is an orderly procedure where two sources of information are intertwined.</p>
</blockquote>
<h1 id="æ„Ÿå—é‡Receptive-Field"><a href="#æ„Ÿå—é‡Receptive-Field" class="headerlink" title="æ„Ÿå—é‡Receptive Field"></a>æ„Ÿå—é‡Receptive Field</h1><p><strong>å®šä¹‰ï¼š</strong> å·ç§¯ç¥ç»ç½‘ç»œå„è¾“å‡ºç‰¹å¾å›¾ä¸­çš„æ¯ä¸ªåƒç´ ç‚¹ï¼Œåœ¨åŸå§‹è¾“å…¥å›¾ç‰‡ä¸Šæ˜ å°„åŒºåŸŸçš„å¤§å°<br><img src="https://i.loli.net/2021/02/22/jCZ6egWkyBzMDL5.png" alt="image.png"><br>å¯ä»¥çœ‹åˆ°åŸå§‹çš„<code>5*5</code>çš„å›¾ç”¨é»„è‰²çš„<code>3*3</code>å·ç§¯æ ¸ä½œç”¨ï¼Œåˆ™å¾—åˆ°äº†ä¸€ä¸ª<code>3*3</code>çš„è¾“å‡ºç‰¹å¾å›¾ï¼Œå›¾ä¸Šçš„æ¯ä¸ªåƒç´ ç‚¹æ˜ å°„åˆ°åŸå§‹è¾“å…¥å›¾ç‰‡æ˜¯<code>3*3</code>çš„åŒºåŸŸï¼Œæ‰€ä»¥å…¶<strong>æ„Ÿå—é‡æ˜¯3</strong><br><img src="https://i.loli.net/2021/02/22/F6ayAlHZi2ObqTt.png" alt="image.png"><br>è€Œå¦‚æœå†å¯¹è¿™ä¸ª<code>3*3</code>çš„è¾“å‡ºç‰¹å¾å›¾ç”¨<code>3*3</code>çš„å·ç§¯æ ¸ä½œç”¨ï¼Œè¾“å‡ºçš„æ˜¯ä¸€ä¸ª<code>1*1</code>çš„è¾“å‡ºç‰¹å¾å›¾ï¼Œè€Œè¿™ä¸ªè¾“å‡ºç‰¹å¾å›¾çš„<strong>æ„Ÿå—é‡æ˜¯5</strong>ï¼Œå› ä¸ºè¦æ˜ å°„åˆ°åŸå§‹å›¾ç‰‡ï¼Œå…ˆæ˜ å°„ä¸€æ¬¡ï¼Œæ˜¯ä¸Šä¸€ä¸ªè¾“å‡ºç‰¹å¾å›¾çš„æ‰€æœ‰ï¼Œåˆ™å†æ˜ å°„å°±æ˜¯åŸå§‹ç‰¹å¾å›¾çš„æ‰€æœ‰äº†ã€‚<br><img src="https://i.loli.net/2021/02/22/n4uvsiVSPxJkFB7.png" alt="image.png"><br>è€Œå¦‚æœ<code>5*5</code>çš„åŸå§‹å›¾ç›´æ¥ç”¨<code>5*5</code>çš„å·ç§¯æ ¸ä½œç”¨ï¼Œå¾—åˆ°çš„æ˜¯<code>1*1</code>çš„è¾“å‡ºç‰¹å¾å›¾ï¼Œ<strong>æ„Ÿå—é‡ä¹Ÿæ˜¯5</strong>    </p>
<p>ä¹Ÿå°±æ˜¯ï¼Œä¸¤å±‚çš„<code>3*3</code>å·ç§¯æ ¸å’Œä¸€å±‚çš„<code>5*5</code>å·ç§¯æ ¸ä½œç”¨å¾—åˆ°çš„è¾“å‡ºç‰¹å¾å›¾çš„æ„Ÿå—é‡éƒ½æ˜¯5ï¼›æ‰€ä»¥è¿™ä¸¤ä¸ªçš„ç‰¹å¾æå–èƒ½åŠ›æ˜¯ä¸€æ ·çš„ã€‚<br>ç”±æ­¤æˆ‘ä»¬å¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œç‰¹å¾æå–èƒ½åŠ›çš„å¯ä»¥é€šè¿‡æ„Ÿå—é‡çš„å¤§å°æ¥åˆ¤æ–­ã€‚<br>é‚£ä¹ˆæ˜¯é€‰æ‹©<code>ä¸¤ä¸ª3*3</code>è¿˜æ˜¯<code>ä¸€ä¸ª5*5</code>å‘¢ï¼Ÿ<br>æ­¤æ—¶åˆ™è€ƒè™‘ä»–ä»¬æ‰€æ‰¿è½½çš„<strong>å¾…è®­ç»ƒå‚æ•°é‡</strong>å’Œ<strong>è®¡ç®—é‡</strong>äº†ã€‚<br><img src="https://i.loli.net/2021/02/22/gTzqi91PBx5puWt.png" alt="image.png"><br><strong>ğŸ±è¡¥å……</strong><br>ç»è¿‡å·ç§¯æ ¸ä½œç”¨åçš„è¾“å‡ºç‰¹å¾å›¾çš„åƒç´ ç‚¹ä¸ªæ•°çš„è®¡ç®—å…¬å¼ã€‚<br>å‡è®¾ï¼Œè¾“å…¥ç‰¹å¾å›¾çš„å®½ã€é«˜ä¸ºx,å·ç§¯æ ¸ä¸ºm<em>mï¼Œåˆ™ç»è¿‡å·ç§¯æ ¸ä½œç”¨åçš„è¾“å‡ºç‰¹å¾å›¾ä¸€å…±æœ‰<code>(x-m+1)^2</code>ä¸ªåƒç´ ç‚¹<br>å¾—åˆ°æ¯ä¸€ä¸ªåƒç´ ç‚¹è¦è¿›è¡Œ<code>m*m</code>æ¬¡ä¹˜åŠ è¿ç®—ï¼Œæ‰€ä»¥æ€»è®¡ç®—é‡ä¸º```m*m</em>(x-m+1)^2```      </p>
<p>æ‰€ä»¥åœ¨ç¥ç»ç½‘ç»œè®¡ç®—ä¸­å¸¸ä½¿ç”¨<code>ä¸¤å±‚3*3å·ç§¯æ ¸</code>æ›¿æ¢<code>5*5å·ç§¯æ ¸</code>çš„åŸå›    </p>
<h1 id="å…¨é›¶å¡«å……"><a href="#å…¨é›¶å¡«å……" class="headerlink" title="å…¨é›¶å¡«å……"></a>å…¨é›¶å¡«å……</h1><p>ä½¿å·ç§¯è®¡ç®—ä¿æŒè¾“å…¥ç‰¹å¾å›¾å°ºå¯¸ä¸å˜ï¼Œåˆ™ç”¨å…¨é›¶å¡«å……<br><img src="https://i.loli.net/2021/02/22/nXliHJ4Ivx73GDQ.png" alt="image.png"><br>ä¹Ÿå°±æ˜¯ï¼Œè¾“å‡ºç‰¹å¾å›¾çš„ç»´åº¦è®¡ç®—å…¬å¼ä¸º<code>VALID</code>éƒ¨åˆ†ã€‚   </p>
<h1 id="æè¿°å·ç§¯è®¡ç®—å±‚"><a href="#æè¿°å·ç§¯è®¡ç®—å±‚" class="headerlink" title="æè¿°å·ç§¯è®¡ç®—å±‚"></a>æè¿°å·ç§¯è®¡ç®—å±‚</h1><p><img src="https://i.loli.net/2021/02/22/ALKBIh94GQErUzi.png" alt="image.png"><br><strong>ğŸ±è¡¥å……</strong><br>BNæ˜¯æŒ‡Batch Normalization,ç‰¹å°±æ˜¯æ‰¹é‡æ ‡å‡†åŒ–å¤„ç†ã€‚  </p>
<h1 id="BN"><a href="#BN" class="headerlink" title="BN"></a>BN</h1><p>ç¥ç»ç½‘ç»œå¯¹0é™„è¿‘çš„æ•°æ®æ›´æ•æ„Ÿï¼Œä½†ä¼šå­˜åœ¨ä¸€äº›ç‰¹å¾å€¼åç¦»0çš„æƒ…å†µï¼Œæ‰€ä»¥å°±æœ‰äº†<code>æ ‡å‡†åŒ–</code><br><strong>æ ‡å‡†åŒ–ï¼š</strong>ä½¿æ•°æ®ç¬¦åˆä»¥0ä¸ºå‡å€¼ï¼Œä»¥1ä¸ºæ ‡å‡†å·®çš„åˆ†å¸ƒ<br><strong>æ‰¹æ ‡å‡†åŒ–ï¼š</strong>å¯¹ä¸€å°æ‰¹æ•°æ®(batch)ï¼Œæ ‡å‡†åŒ–å¤„ç†<br>BNå¸¸ç”¨åœ¨å·ç§¯æ“ä½œå’Œæ¿€æ´»æ“ä½œä¹‹é—´<br><img src="https://i.loli.net/2021/02/22/kIOLWd6aJtubGRq.png" alt="image.png"><br>æ‰¹æ ‡å‡†åŒ–æ“ä½œä¼šè®©æ¯ä¸ªåƒç´ ç‚¹è¿›è¡Œ<code>å‡å‡å€¼å¹¶å¤„ä»¥æ ‡å‡†å·®</code>çš„è‡ªæ›´æ–°è®¡ç®—<br><img src="https://i.loli.net/2021/02/22/aibSC7FtvhjTJmG.png" alt="image.png"><br>é€šè¿‡BNæ“ä½œï¼Œä½¿å¾—ç‰¹å¾æ•°æ®é›†ä¸­åœ¨æ¿€æ´»å‡½æ•°çº¿æ€§å˜åŒ–åŒºé—´ï¼Œä½¿å¾—å°±ç®—ç‰¹å¾æ•°æ®å˜åŒ–å°ï¼Œä¹Ÿèƒ½æ˜æ˜¾åœ°æç°åˆ°æ¿€æ´»å‡½æ•°è¾“å‡ºä¸­ï¼Œæå‡äº†æ¿€æ´»å‡½æ•°å¯¹è¾“å…¥æ•°æ®åœ°åŒºåˆ†åŠ›<br>ä½†è¿™æ ·ç®€å•çš„æ ‡å‡†åŒ–ï¼Œä½¿å¾—ç‰¹å¾æ•°æ®å®Œå…¨æ»¡è¶³æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œé›†ä¸­åœ¨æ¿€æ´»å‡½æ•°ä¸­å¿ƒçš„çº¿æ€§åŒºåŸŸï¼Œæ˜¯æ¿€æ´»å‡½æ•°ä¸§å¤±ï¼›äº†éçº¿æ€§ç‰¹æ€§ï¼Œå› æ­¤åœ¨BNæ“ä½œä¸­ä¸ºæ¯ä¸ªå·ç§¯æ ¸å¼•å…¥äº†ä¸¤ä¸ªå¯è®­ç»ƒå‚æ•°ï¼Œç¼©æ”¾å› å­Î³å’Œåç§»å› å­Î²<br>è¿™ä¸¤ä¸ªå› å­ä¼šä¸å…¶ä»–å¸¦è®­ç»ƒå‚æ•°ä¸€åŒè¢«è®­ç»ƒä¼˜åŒ–ï¼Œæ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒåçš„ç‰¹å¾æ•°æ®é€šè¿‡ç¼©æ”¾å› å­å’Œåç§»å› å­ä¼˜åŒ–äº†ç‰¹å¾æ•°æ®åˆ†å¸ƒçš„å®½çª„å’Œåç§»é‡ï¼Œä¿è¯äº†ç½‘ç»œçš„éçº¿æ€§è¡¨è¾¾åŠ›<br><img src="https://i.loli.net/2021/02/22/KA1q8HGwh9oFpYb.png" alt="image.png">   </p>
<h1 id="æ± åŒ–Pooling"><a href="#æ± åŒ–Pooling" class="headerlink" title="æ± åŒ–Pooling"></a>æ± åŒ–Pooling</h1><p><strong>æ± åŒ–ç”¨äºå‡å°‘ç‰¹å¾æ•°æ®é‡</strong><br>æ± åŒ–çš„ä¸»è¦æ–¹æ³•   </p>
<ul>
<li>æœ€å¤§æ± åŒ–<br>å¯æå–å›¾ç‰‡çº¹ç†<br>å› ä¸ºæå–äº†ä¸»è¦ç‰¹å¾ï¼Œæ‰€ä»¥ç›¸å½“äºçº¹ç†  </li>
<li>å‡å€¼æ± åŒ–<br>å¯ä¿ç•™èƒŒæ™¯ç‰¹å¾ã€‚<br><img src="https://i.loli.net/2021/02/22/hoBeALYsGSuyM2m.png" alt="image.png"><br>å¦‚å›¾æ‰€ç¤ºï¼Œç”¨äº†ä¸€ä¸ª2<em>2çš„æ± åŒ–æ ¸ï¼Œå¯¹è¾“å…¥å›¾ç‰‡è¿›è¡Œäº†ä»¥2ä¸ºæ­¥é•¿çš„æ± åŒ–ã€‚<br>ä¹Ÿå°±æ˜¯æˆ‘ç”¨ä¸€ä¸ª2</em>2çš„æ–¹æ¡†ï¼Œæ¡†ä½äº†å›¾ç‰‡é‡Œå¯¹åº”çš„å››ä¸ªåƒç´ ç‚¹ï¼Œé€šè¿‡æ± åŒ–æ–¹æ³•ï¼Œæ¯”å¦‚æœ€å¤§æ± åŒ–ï¼Œé€‰æ‹©è¿™å››ä¸ªåƒç´ ç‚¹ä¸­æœ€å¤§çš„æ•°ä½œä¸ºè¾“å‡ºçš„åƒç´ ç‚¹å€¼ï¼Œæˆ–è€…å‡å€¼æ± åŒ–ï¼Œå–è¿™å››ä¸ªåƒç´ ç‚¹çš„å‡å€¼ä½œä¸ºè¾“å‡ºçš„åƒç´ ç‚¹å€¼ï¼Œå¾—åˆ°æˆ‘ä»¬ç»è¿‡æ± åŒ–åçš„åŸå›¾å¤§å°çš„å››åˆ†ä¹‹ä¸€ã€‚<br><img src="https://i.loli.net/2021/02/22/DZgYfNi3HB4b8Pp.png" alt="image.png"><br><img src="https://i.loli.net/2021/02/22/6udcfhL4DPYVS5H.png" alt="image.png"></li>
</ul>
<h1 id="èˆå¼ƒDropout"><a href="#èˆå¼ƒDropout" class="headerlink" title="èˆå¼ƒDropout"></a>èˆå¼ƒDropout</h1><p>ä¸ºäº†ç¼“è§£ç¥ç»ç½‘ç»œè¿‡æ‹Ÿåˆï¼Œåœ¨ç¥ç»ç½‘ç»œè®­ç»ƒæ—¶ï¼Œå°†éšè—å±‚çš„ä¸€éƒ¨åˆ†ç¥ç»å…ƒæŒ‰ç…§ä¸€å®šæ¦‚ç‡ä»ç¥ç»ç½‘ç»œä¸­æš‚æ—¶èˆå¼ƒã€‚åœ¨ç¥ç»ç½‘ç»œä½¿ç”¨æ—¶ï¼Œè¢«èˆå¼ƒçš„ç¥ç»å…ƒæ¢å¤è¿æ¥ã€‚   </p>
<p><img src="https://i.loli.net/2021/02/22/64PE7DiGgNWXfM5.png" alt="image.png">    </p>
<h1 id="å·ç§¯ç¥ç»ç½‘ç»œ"><a href="#å·ç§¯ç¥ç»ç½‘ç»œ" class="headerlink" title="å·ç§¯ç¥ç»ç½‘ç»œ"></a>å·ç§¯ç¥ç»ç½‘ç»œ</h1><p>å·ç§¯ç¥ç»ç½‘ç»œå°±æ˜¯å€ŸåŠ©å·ç§¯æ ¸å¯¹è¾“å…¥ç‰¹å¾è¿›è¡Œç‰¹å¾æå–ï¼Œæå–åé€å…¥å…¨è¿æ¥ç½‘ç»œè¿›è¡Œè¯†åˆ«é¢„æµ‹<br><img src="https://i.loli.net/2021/02/22/FrtYCqnyZcmDhT6.png" alt="image.png">   </p>
<p><img src="https://i.loli.net/2021/02/22/qCKZTbpyrPXxvU4.png" alt="image.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/21/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%85%AB%E8%82%A1%E5%8A%9F%E8%83%BD%E6%89%A9%E5%B1%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/21/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%85%AB%E8%82%A1%E5%8A%9F%E8%83%BD%E6%89%A9%E5%B1%95/" class="post-title-link" itemprop="url">ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-21 20:02:20" itemprop="dateCreated datePublished" datetime="2021-02-21T20:02:20+08:00">2021-02-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-02-22 13:53:29" itemprop="dateModified" datetime="2021-02-22T13:53:29+08:00">2021-02-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="è‡ªåˆ¶æ•°æ®é›†"><a href="#è‡ªåˆ¶æ•°æ®é›†" class="headerlink" title="è‡ªåˆ¶æ•°æ®é›†"></a>è‡ªåˆ¶æ•°æ®é›†</h1><p>æ„æ€å°±æ˜¯ï¼Œè‹¥æˆ‘æœ‰ä¸€å †å›¾ç‰‡ï¼Œä¸€ä¸ªæ ‡ç­¾æ–‡æœ¬ï¼Œå¦‚ä½•æå–åšå‡ºæˆ‘ä»¬çš„<code>x_train,y_train</code><br>é¦–å…ˆæˆ‘ä»¬å°†æ ‡ç­¾æ–‡æœ¬æ•´ç†ï¼Œç¬¬ä¸€åˆ—æ˜¯å›¾ç‰‡åç§°ï¼Œç¬¬äºŒåˆ—å°±æ˜¯è¯¥å›¾ç‰‡å¯¹åº”çš„æ ‡ç­¾ã€‚<br>ä¸ºä»€ä¹ˆæ˜¯å›¾ç‰‡åç§°ï¼Ÿ<br>å› ä¸ºï¼Œæˆ‘ä»¬è¦æå–å‡º<code>x,y</code>ä¹Ÿå°±æ˜¯ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªå›¾ç‰‡ä¸­æå–äº†å®ƒçš„ç°åº¦å€¼ï¼Œè¦èƒ½å¤Ÿä¸yå¯¹åº”ã€‚<br>è€Œå¦‚ä½•æå–ä¸€ä¸ªå›¾ç‰‡çš„åƒç´ å€¼ï¼Ÿ<br>å¯¼å…¥<code>PIL</code>åº“ä¸­çš„<code>Image</code>,ç”¨<code>Imag.open(å›¾ç‰‡è·¯å¾„)</code>è¯»å…¥å›¾ç‰‡ï¼Œ<code>np.array(img.convert(&#39;L&#39;))</code>è½¬å˜ä¸ºç°åº¦å€¼çš„<code>np.array</code>æ ¼å¼ï¼Œæ­¤æ—¶å…¶å®å°±æ‹¿åˆ°äº†æˆ‘ä»¬çš„xï¼Œå›¾ç‰‡å¯¹åº”çš„ç°åº¦å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜åº”è¯¥åšå½’ä¸€åŒ–å¤„ç†<code>img/255</code><br>æ­¤æ—¶æˆ‘ä»¬å°±å¾—åˆ°äº†æˆ‘ä»¬çš„xï¼Œé‚£ä¹ˆè¦ä¸yå¯¹åº”ï¼Œå°±è¦ä¿è¯åœ¨<code>æ ‡ç­¾çš„txt</code>æ–‡æ¡£ä¸­ï¼Œåå­—ä¸æ ‡ç­¾ä¸€ä¸€å¯¹åº”ï¼Œå†åœ¨è¯»å–å›¾ç‰‡æ—¶å›¾ç‰‡æ‰€åœ¨ç›®å½•<code>path</code>åŠ ä¸Šå›¾ç‰‡åå­—å°±æ˜¯å›¾ç‰‡çš„<code>path</code>ã€‚    </p>
<p>ğŸ†å…·ä½“ä»£ç å¦‚ä¸‹<br><img src="https://i.loli.net/2021/02/21/tcNxvV1ewHmJZnp.png" alt="image.png"><br><img src="https://i.loli.net/2021/02/21/VXqHKwU9rFE41QI.png" alt="image.png"></p>
<h1 id="æ•°æ®å¢å¼º"><a href="#æ•°æ®å¢å¼º" class="headerlink" title="æ•°æ®å¢å¼º"></a>æ•°æ®å¢å¼º</h1><p>æ•°æ®å¢å¼ºå¯ä»¥å¸®åŠ©æ‰©å±•æ•°æ®é›†<br>å¯¹å›¾åƒçš„å¢å¼ºï¼Œå°±æ˜¯å¯¹å›¾åƒçš„ç®€å•å½¢å˜ã€‚<br>Tensorlow2æœ‰æ•°æ®å¢å¼ºå‡½æ•°<br><img src="https://i.loli.net/2021/02/21/6FDYsyQNM9ohanb.png" alt="image.png"><br><img src="https://i.loli.net/2021/02/21/EPkrO7dFKetN8y9.png" alt="image.png"><br>è¿™ä¸ªç›¸å½“äºå‰é¢æ˜¯ä¸€ç§è®¾ç½®ï¼Œç„¶åç”¨<code>fit()</code>æŠŠè®¾ç½®çš„å‚æ•°æ”¾åœ¨æˆ‘ä»¬çš„è®­ç»ƒé›†ä¸­<code>x_train</code><br>è€Œè¿™é‡Œçš„<code>imag_gen_train_fit(x_train)</code>éœ€è¦è¾“å…¥ä¸€ä¸ªå››ä½æ•°æ®ï¼Œæ‰€ä»¥è¦å¯¹<code>x_train.reshape(x_train.shape[0],28,28,1)</code><br>ä¹Ÿå°±æ˜¯å°†(60000,28,28) -&gt; (60000,28,28,1)<br><img src="https://i.loli.net/2021/02/21/v96z4hRuZDcOApm.png" alt="image.png">    </p>
<h1 id="æ–­ç‚¹ç»­è®­"><a href="#æ–­ç‚¹ç»­è®­" class="headerlink" title="æ–­ç‚¹ç»­è®­"></a>æ–­ç‚¹ç»­è®­</h1><p><strong>å®šä¹‰ï¼š</strong> åœ¨è¿›è¡Œç¥ç»ç½‘ç»œè®­ç»ƒè¿‡ç¨‹ä¸­ç”±äºä¸€äº›å› ç´ å¯¼è‡´è®­ç»ƒæ— æ³•è¿›è¡Œï¼Œéœ€è¦ä¿å­˜å½“å‰çš„è®­ç»ƒç»“æœï¼Œä¸‹æ¬¡æ¥ç€è®­ç»ƒ    </p>
<h2 id="è¯»å–æ¨¡å‹"><a href="#è¯»å–æ¨¡å‹" class="headerlink" title="è¯»å–æ¨¡å‹"></a>è¯»å–æ¨¡å‹</h2><p>å¯ç›´æ¥ä½¿ç”¨tensorflowç»™å‡ºçš„å‡½æ•°<code>load_weights(è·¯å¾„æ–‡ä»¶å)</code>è¯»å–å·²æœ‰æ¨¡å‹å‚æ•°<br>å…ˆå®šä¹‰å‡ºå­˜æ”¾æ¨¡å‹çš„è·¯å¾„å’Œæ–‡ä»¶åï¼Œå¹¶å‘½åä¸ºckptæ–‡ä»¶<code>checkpoint_save_path = &quot;./checkpoint/mnist.ckpt&quot;</code><br><strong>ğŸ±è¡¥å……</strong> ckptæ–‡ä»¶ç”¨äºå­˜æ”¾<code>weightsã€biasesã€gradientsç­‰</code>å˜é‡<br>åœ¨ç”Ÿæˆ<code>ckpt</code>æ–‡ä»¶æ—¶ä¼šåŒæ­¥ç”Ÿæˆç´¢å¼•è¡¨ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡åˆ¤æ–­æ˜¯å¦å·²æœ‰ç´¢å¼•è¡¨ï¼Œå°±çŸ¥é“æ˜¯ä¸æ˜¯å·²ç»ä¿å­˜è¿‡æ¨¡å‹å‚æ•°äº†<code>if os.path.exists(checkpoint_save_path + &#39;.index&#39;):</code><br>å¦‚æœæœ‰äº†ç´¢å¼•è¡¨ï¼Œå°±å¯ä»¥è°ƒç”¨<code>model.load_weights(checkpoint_save_path)</code>å‡½æ•°ï¼Œæ¥è¯»å–æ¨¡å‹å‚æ•°ã€‚</p>
<h2 id="ä¿å­˜æ¨¡å‹"><a href="#ä¿å­˜æ¨¡å‹" class="headerlink" title="ä¿å­˜æ¨¡å‹"></a>ä¿å­˜æ¨¡å‹</h2><p>ä¿å­˜æ¨¡å‹å‚æ•°å¯ä»¥ä½¿ç”¨tensorflowçš„å›è°ƒå‡½æ•°ç›´æ¥ä¿å­˜è®­ç»ƒå‡ºæ¥çš„å‚æ•°ã€‚     </p>
<pre><code>tf.keras.callbacks.ModelCheckpoint(
    filepath = è·¯å¾„æ–‡ä»¶å,   
    save_weights_only =True/False, #æ˜¯å¦åªä¿ç•™æ¨¡å‹å‚æ•°
    save_best_only=True/False   #æ˜¯å¦åªä¿ç•™æœ€ä¼˜ç»“æœ
)
history = model.fit(callbacks=[cp_callback])</code></pre><p><img src="https://i.loli.net/2021/02/21/obsF9EQxZ3KzCNM.png" alt="image.png"></p>
<p><img src="https://i.loli.net/2021/02/21/lpXTjmz4kU29oZ5.png" alt="image.png"></p>
<h2 id="å‚æ•°æå–"><a href="#å‚æ•°æå–" class="headerlink" title="å‚æ•°æå–"></a>å‚æ•°æå–</h2><p><strong>æŠŠå‚æ•°å­˜å…¥æ–‡æœ¬</strong><br>Tensorflowä¸­å¯ä»¥ç”¨<code>model.trainable_variables</code>è¿”å›å½“å‰æ¨¡å‹ä¸­æ‰€æœ‰å¯è®­ç»ƒå‚æ•°<br>å¯ä»¥ç”¨<code>print</code>å‡½æ•°æ‰“å°å‡ºè¿™äº›å¯è®­ç»ƒå‚æ•°<br>ä½†æ˜¯å¦‚æœç›´æ¥<code>print</code>ï¼Œå¾ˆå¤šå‚æ•°ä¼šè¢«çœç•¥å·æ›¿æ¢æ‰,å¯ä»¥é€šè¿‡<code>np.set_printoptions(threshold=è¶…è¿‡å¤šå°‘çœç•¥æ˜¾ç¤º)</code>è®¾ç½®æ‰“å°æ•ˆæœ<br>è®¾ç½®ä¸º<code>np.set_printoptions(threshold=np.inf)</code>åˆ™ï¼Œæ‰€æœ‰éƒ½ä¸çœç•¥ï¼Œéƒ½æ‰“å°<br>è¿™æ—¶ï¼Œå†<code>print(model.trainable_variables)</code>å°±å¯ä»¥æ‰“å°å‡ºæ‰€æœ‰å¯è®­ç»ƒå‚æ•°äº†    </p>
<h2 id="acc-losså¯è§†åŒ–"><a href="#acc-losså¯è§†åŒ–" class="headerlink" title="acc/losså¯è§†åŒ–"></a>acc/losså¯è§†åŒ–</h2><p>åœ¨<code>model.fit()</code>ä¸­è®°å½•äº†<code>è®­ç»ƒé›†lossã€æµ‹è¯•é›†lossã€è®­ç»ƒé›†å‡†ç¡®ç‡sparse_categorical_accuracyã€æµ‹è¯•é›†å‡†ç¡®ç‡val_sparse_categorical_accuracy</code>    </p>
<pre><code>history = model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1,
                callbacks=[cp_callback])


# æå–äº†model.fitå‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¿å­˜çš„è®­ç»ƒé›†å‡†ç¡®ç‡ç­‰
acc = history.history[&apos;sparse_categorical_accuracy&apos;]
val_acc = history.history[&apos;val_sparse_categorical_accuracy&apos;]
loss = history.history[&apos;loss&apos;]
val_loss = history.history[&apos;val_loss&apos;]

plt.subplot(1, 2, 1)
plt.plot(acc, label=&apos;Training Accuracy&apos;)
plt.plot(val_acc, label=&apos;Validation Accuracy&apos;)
plt.title(&apos;Training and Validation Accuracy&apos;)
plt.legend()

plt.subplot(1, 2, 2)
plt.plot(loss, label=&apos;Training Loss&apos;)
plt.plot(val_loss, label=&apos;Validation Loss&apos;)
plt.title(&apos;Training and Validation Loss&apos;)
plt.legend()
plt.show()</code></pre><p><img src="https://i.loli.net/2021/02/22/Z2tRlU8SGAc3p4H.png" alt="image.png"></p>
<h2 id="ç»™å›¾è¯†ç‰©"><a href="#ç»™å›¾è¯†ç‰©" class="headerlink" title="ç»™å›¾è¯†ç‰©"></a>ç»™å›¾è¯†ç‰©</h2><p>æ„æ€åº”è¯¥æ˜¯ï¼Œæˆ‘ç°åœ¨æœ‰ä¸€ä¸ªæ¨¡å‹äº†ï¼Œé‚£ä¹ˆæˆ‘è¦å¦‚ä½•æŠŠæˆ‘è¦æµ‹è¯•çš„åŠ è½½è¿›å»ï¼Œå¾—åˆ°ç›¸åº”çš„ç»“æœ<br>è¿ç”¨<code>predict(è¾“å…¥ç‰¹å¾,batch_size=æ•´æ•°)</code>è¿”å›å‰å‘ä¼ æ’­è®¡ç®—ç»“æœ<br>    # å¤ç°æ¨¡å‹<br>    model = tf.keras.models.Sequential([<br>        tf.keras.layers.Flatten(),<br>        tf.keras.layers.Dense(128,activation=â€™reluâ€™),<br>        tf.keras.layers.Dense(10,activation=â€™softmaxâ€™)<br>    ])</p>
<pre><code># åŠ è½½å‚æ•°   
model.load_weights(model_save_path)   

# é¢„æµ‹ç»“æœ
result = model.predict(x_predict)    </code></pre><p><strong>ä»£ç æ€è·¯:</strong><br>ç›®çš„æ˜¯ï¼Œæˆ‘ç°åœ¨è®­ç»ƒäº†ä¸€ä¸ªæ¨¡å‹ï¼Œæœ‰ä¸€å †æµ‹è¯•å›¾ç‰‡ï¼Œæ¥æµ‹è¯•è¿™ä¸ªç¥ç»ç½‘ç»œæ¨¡å‹<br>é¦–å…ˆï¼Œæˆ‘è¦åŠ è½½å‡ºæˆ‘çš„ç½‘ç»œï¼Œä¹Ÿå°±æ˜¯ç»™å‡ºå…¶åœ°å€ï¼ŒåŠ è½½å‡ºå‚æ•°ï¼Œç„¶åè¦å–‚å…¥æˆ‘çš„æµ‹è¯•é›†çš„æ•°æ®  </p>
<pre><code>model_save_path = &apos;./checkpoint/mnist.ckpt&apos;

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation=&apos;relu&apos;),
    tf.keras.layers.Dense(10, activation=&apos;softmax&apos;)])

model.load_weights(model_save_path)</code></pre><p>é‚£ä¹ˆæˆ‘ç°åœ¨æ—¶éšä¾¿ç»™çš„å›¾ç‰‡ï¼Œå¤§å°ï¼Œåƒç´ ç‚¹çš„å€¼ä¹Ÿä¸æˆ‘åŸæœ¬çš„ä¸ä¸€æ ·ã€‚<br>æ‹¿mnistä¸¾ä¾‹ï¼Œç»™å‡ºçš„å…¨æ˜¯28*28çš„é»‘åº•ç™½å­—çš„å›¾ç‰‡ï¼Œé‚£ä¹ˆæˆ‘å¯¹æˆ‘çš„å›¾ç‰‡è¿›è¡Œé¢„å¤„ç†ã€‚    </p>
<ul>
<li><p>æ³•ä¸€<br>å‡¡æ˜¯ï¼Œç°åº¦åå€¼å°äº200çš„å…¨è®¾ä¸º255ï¼Œä¹Ÿå°±æ˜¯è®¾ä¸ºç™½è‰²ï¼›å‡¡æ˜¯å¤§äºçš„è®¾ä¸ºé»‘è‰²ï¼Œåˆ™åè½¬äº†    </p>
</li>
<li><p>æ³•äºŒ<br>ç›´æ¥åï¼Œ<code>img_arr = 255-img_arr</code>    </p>
<h1 id="å¯¹å›¾ç‰‡è¿›è¡Œå¤„ç†"><a href="#å¯¹å›¾ç‰‡è¿›è¡Œå¤„ç†" class="headerlink" title="å¯¹å›¾ç‰‡è¿›è¡Œå¤„ç†"></a>å¯¹å›¾ç‰‡è¿›è¡Œå¤„ç†</h1><p>  preNum = int(input(â€œinput the number of test pictures:â€))</p>
<p>  for i in range(preNum):</p>
<pre><code>image_path = input(&quot;the path of test picture:&quot;)
img = Image.open(image_path)
img = img.resize((28, 28), Image.ANTIALIAS)
img_arr = np.array(img.convert(&apos;L&apos;))</code></pre><p>  #ç¬¬äºŒç§æ–¹æ³•ï¼Œç›´æ¥é¢ å€’</p>
<pre><code>img_arr = 255 - img_arr</code></pre><p>  #ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæ¨¡ç³ŠåŒ–ï¼Œå…¨éƒ¨å˜ä¸ºé»‘ç™½    </p>
<pre><code>for i in range(28):
    for j in range(28):
        if img_arr[i][j] &lt; 200:
            img_arr[i][j] = 255
        else:
            img_arr[i][j] = 0</code></pre></li>
</ul>
<pre><code>#æœ€åè®°å¾—å½’ä¸€åŒ–å¤„ç†   
img_arr = img_arr / 255.0


#img.resize((width, height),Image.ANTIALIAS)
ç¬¬äºŒä¸ªå‚æ•°ï¼š
    Image.NEAREST ï¼šä½è´¨é‡
    Image.BILINEARï¼šåŒçº¿æ€§
    Image.BICUBIC ï¼šä¸‰æ¬¡æ ·æ¡æ’å€¼
    Image.ANTIALIASï¼šé«˜è´¨é‡</code></pre><p>æ­¤æ—¶æˆ‘ä»¬çš„å›¾ç‰‡æ•°æ®ä¹Ÿå‡†å¤‡å¥½äº†ï¼Œä½†è¿™é‡Œè¦æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒé›†ä¸­å–‚å…¥çš„æ˜¯ä¸‰ç»´ï¼Œæ‰€ä»¥è¦åŠ ä¸€ç»´<code>x_predict = img_arr[tf.newaxis, ...]</code><br><strong>æœ€åå®Œæ•´ç‰ˆä»£ç ï¼š</strong><br>    from PIL import Image<br>    import numpy as np<br>    import tensorflow as tf</p>
<pre><code>model_save_path = &apos;./checkpoint/mnist.ckpt&apos;

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation=&apos;relu&apos;),
    tf.keras.layers.Dense(10, activation=&apos;softmax&apos;)])

model.load_weights(model_save_path)

preNum = int(input(&quot;input the number of test pictures:&quot;))

for i in range(preNum):
    image_path = input(&quot;the path of test picture:&quot;)
    img = Image.open(image_path)
    img = img.resize((28, 28), Image.ANTIALIAS)
    img_arr = np.array(img.convert(&apos;L&apos;))

    for i in range(28):
        for j in range(28):
            if img_arr[i][j] &lt; 200:
                img_arr[i][j] = 255
            else:
                img_arr[i][j] = 0

    img_arr = img_arr / 255.0
    x_predict = img_arr[tf.newaxis, ...]
    result = model.predict(x_predict)

    pred = tf.argmax(result, axis=1)

    print(&apos;\n&apos;)
    tf.print(pred)</code></pre><p><img src="https://i.loli.net/2021/02/22/P2Ad1vEB8ysTfxL.png" alt="image.png"><br><img src="https://i.loli.net/2021/02/22/FJqbSR7eusfYUHx.png" alt="image.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/19/Tensorflow%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%9B%9B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/19/Tensorflow%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%9B%9B/" class="post-title-link" itemprop="url">Tensorflowå­¦ä¹ ç¬”è®°(å››)</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-19 14:02:50" itemprop="dateCreated datePublished" datetime="2021-02-19T14:02:50+08:00">2021-02-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-02-21 19:52:24" itemprop="dateModified" datetime="2021-02-21T19:52:24+08:00">2021-02-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MNISTæ•°æ®é›†"><a href="#MNISTæ•°æ®é›†" class="headerlink" title="MNISTæ•°æ®é›†"></a>MNISTæ•°æ®é›†</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><ul>
<li>æä¾›å…­ä¸‡å¼ 28*28åƒç´ ç‚¹çš„0~9æ‰‹å†™æ•°å­—å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºè®­ç»ƒ   </li>
<li>æä¾›ä¸€ä¸‡å¼ 28*28åƒç´ ç‚¹çš„0~9æ‰‹å†™æ•°å­—å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºæµ‹è¯• </li>
</ul>
<pre><code>#å¯¼å…¥MNISTæ•°æ®é›†  
mnist = tf.keras.datasets.mnist
(x_train,y_train),(x_test,y_test) =mnist.load_data()   

#å°†æ‰€æœ‰åƒç´ ç‚¹(28*28=784)çš„ç°åº¦å€¼ä½œä¸ºè¾“å…¥ç‰¹å¾ï¼Œè¾“å…¥ç¥ç»ç½‘ç»œæ—¶ï¼Œå°†æ•°æ®æ‹‰ä¼¸ä¸ºä¸€ç»´æ•°ç»„:   
tf.keras.layers.Flatten()    </code></pre><h2 id="æ•°æ®é›†"><a href="#æ•°æ®é›†" class="headerlink" title="æ•°æ®é›†"></a>æ•°æ®é›†</h2><pre><code>import tensorflow as tf
from matplotlib import pyplot as plt

mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()

# å¯è§†åŒ–è®­ç»ƒé›†è¾“å…¥ç‰¹å¾çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
plt.imshow(x_train[0], cmap=&apos;gray&apos;)  # ç»˜åˆ¶ç°åº¦å›¾
plt.show()

# æ‰“å°å‡ºè®­ç»ƒé›†è¾“å…¥ç‰¹å¾çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
print(&quot;x_train[0]:\n&quot;, x_train[0])
# æ‰“å°å‡ºè®­ç»ƒé›†æ ‡ç­¾çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
print(&quot;y_train[0]:\n&quot;, y_train[0])

# æ‰“å°å‡ºæ•´ä¸ªè®­ç»ƒé›†è¾“å…¥ç‰¹å¾å½¢çŠ¶
print(&quot;x_train.shape:\n&quot;, x_train.shape)
# æ‰“å°å‡ºæ•´ä¸ªè®­ç»ƒé›†æ ‡ç­¾çš„å½¢çŠ¶
print(&quot;y_train.shape:\n&quot;, y_train.shape)
# æ‰“å°å‡ºæ•´ä¸ªæµ‹è¯•é›†è¾“å…¥ç‰¹å¾çš„å½¢çŠ¶
print(&quot;x_test.shape:\n&quot;, x_test.shape)
# æ‰“å°å‡ºæ•´ä¸ªæµ‹è¯•é›†æ ‡ç­¾çš„å½¢çŠ¶
print(&quot;y_test.shape:\n&quot;, y_test.shape)</code></pre><p>xæœªæˆªå®Œï¼Œå¯ä»¥çœ‹è§ï¼Œxæ˜¯28<em>28çš„çŸ©é˜µï¼Œæ¯ä¸€ä¸ªç‚¹ï¼Œä»£è¡¨è¯¥å¤„çš„ç°åº¦å€¼<br>0è¡¨ç¤ºé»‘è‰²ï¼Œ255è¡¨ç¤ºçº¯ç™½è‰²<br><img src="https://i.loli.net/2021/02/21/ws3MbZCXG4xVPi5.png" alt=""><br>yåˆ™æ˜¯æ ‡ç­¾ä¹Ÿå°±æ˜¯è¯¥å›¾ç‰‡å¯¹åº”çš„æ•°å€¼æ˜¯æŒ‡å¤šå°‘ã€‚<br>å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ª<code>x_train</code>æ˜¯60000ä¸ª28</em>28çš„çŸ©é˜µï¼Œè€Œ<code>y_train</code>æ˜¯60000ä¸ªå€¼ï¼Œæ˜¯ä¸€ä¸ªåˆ—å‘é‡ã€‚<br><img src="https://i.loli.net/2021/02/21/HpIDnVXKeLSsh4B.png" alt="image.png"><br><img src="https://i.loli.net/2021/02/21/lT3OfDFC7H9tj5s.png" alt="image.png">   </p>
<h2 id="Sequentialå®ç°"><a href="#Sequentialå®ç°" class="headerlink" title="Sequentialå®ç°"></a>Sequentialå®ç°</h2><pre><code>import tensorflow as tf

mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0  #å½’ä¸€åŒ–ï¼Œä½¿0-255çš„ç°åº¦å€¼å˜æˆ0-1ä¹‹é—´çš„æ•°å€¼

model = tf.keras.models.Sequential([                #è¾“å…¥å±‚æ˜¯ä¸ç”¨å®šä¹‰çš„
    tf.keras.layers.Flatten(),                      #æŠŠè¾“å…¥ç‰¹å¾æ‹‰ç›´ä¸ºä¸€ç»´æ•°ç»„
    tf.keras.layers.Dense(128, activation=&apos;relu&apos;),      #éšè—å±‚ï¼Œæ¿€æ´»å‡½æ•°relu
    tf.keras.layers.Dense(10, activation=&apos;softmax&apos;)    #è¾“å‡ºå±‚ï¼Œç”¨softmaxä½¿è¾“å‡ºç¬¦åˆæ¦‚ç‡åˆ†å¸ƒ
])

#é…ç½®è®­ç»ƒæ–¹æ³•
model.compile(optimizer=&apos;adam&apos;,  #ä¼˜åŒ–å™¨
            loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),   #å› ä¸ºä¸æ˜¯åŸå§‹è¾“å‡ºï¼Œè€Œæ˜¯ç”¨äº†æ¦‚ç‡åˆ†å¸ƒï¼Œæ‰€ä»¥ç”¨false
            metrics=[&apos;sparse_categorical_accuracy&apos;]) #æ•°æ®é›†æ ‡ç­¾æ˜¯æ•°å€¼ï¼Œç¥ç»ç½‘ç»œè¾“å‡ºæ˜¯æ¦‚ç‡åˆ†å¸ƒ

model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1)
model.summary()</code></pre><h2 id="classå®ç°"><a href="#classå®ç°" class="headerlink" title="classå®ç°"></a>classå®ç°</h2><pre><code>import tensorflow as tf
from tensorflow.keras.layers import Dense, Flatten
from tensorflow.keras import Model

mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0


class MnistModel(Model):
    def __init__(self):
        super(MnistModel, self).__init__()
        self.flatten = Flatten()
        self.d1 = Dense(128, activation=&apos;relu&apos;)
        self.d2 = Dense(10, activation=&apos;softmax&apos;)

    def call(self, x):
        x = self.flatten(x)
        x = self.d1(x)
        y = self.d2(x)
        return y


model = MnistModel()

model.compile(optimizer=&apos;adam&apos;,
            loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
            metrics=[&apos;sparse_categorical_accuracy&apos;])

model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1)
model.summary()</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/19/Tensorflow%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%B8%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/19/Tensorflow%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%B8%89/" class="post-title-link" itemprop="url">Tensorflowå­¦ä¹ ç¬”è®°(ä¸‰)</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-02-19 09:45:00 / Modified: 14:01:50" itemprop="dateCreated datePublished" datetime="2021-02-19T09:45:00+08:00">2021-02-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>ç”¨Sequentialå¯ä»¥æ­å»ºå‡ºä¸Šå±‚è¾“å‡ºå°±æ˜¯ä¸‹å±‚è¾“å…¥çš„é¡ºåºç½‘ç»œç»“æ„ï¼Œä½†æ— æ³•å†™å‡ºä¸€äº›å¸¦æœ‰è·³è¿çš„éé¡ºåºç½‘ç»œç»“æ„ã€‚<br>æ­¤æ—¶é€‰æ‹©ç”¨ç±»classæ­å»ºç¥ç»ç½‘ç»œç»“æ„<br><strong>ğŸ±å…­æ­¥æ³•</strong>   </p>
<ul>
<li>import</li>
<li>trainï¼Œtest</li>
<li>class MyModel(Model) model=MyModel   </li>
<li>model.compile</li>
<li>model.fit</li>
<li>model.summary</li>
</ul>
<h1 id="classç±»å°è£…ç¥ç»ç½‘ç»œç»“æ„"><a href="#classç±»å°è£…ç¥ç»ç½‘ç»œç»“æ„" class="headerlink" title="classç±»å°è£…ç¥ç»ç½‘ç»œç»“æ„"></a>classç±»å°è£…ç¥ç»ç½‘ç»œç»“æ„</h1><pre><code>âœ¨
class MyModel(Model):
    def __init__(self):
        super(MyModel,self).__init__()
        å®šä¹‰ç½‘ç»œç»“æ„å—
    def call(self,x):
        è°ƒç”¨ç½‘ç»œç»“æ„å—ï¼Œå®ç°å‰å‘ä¼ æ’­
        return y
model = MyModel()
âœ¨



ğŸ†#é¸¢å°¾èŠ±   

import tensorflow as tf
from tensorflow.keras.layers import Dense
from tensorflow.keras import Model
from sklearn import datasets
import numpy as np

x_train = datasets.load_iris().data
y_train = datasets.load_iris().target

np.random.seed(116)
np.random.shuffle(x_train)
np.random.seed(116)
np.random.shuffle(y_train)
tf.random.set_seed(116)

class IrisModel(Model):
    def __init__(self):
        super(IrisModel, self).__init__()
        self.d1 = Dense(3, activation=&apos;softmax&apos;, kernel_regularizer=tf.keras.regularizers.l2())

    def call(self, x):
        y = self.d1(x)
        return y

model = IrisModel()

model.compile(optimizer=tf.keras.optimizers.SGD(lr=0.1),
            loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
            metrics=[&apos;sparse_categorical_accuracy&apos;])

model.fit(x_train, y_train, batch_size=32, epochs=500, validation_split=0.2, validation_freq=20)
model.summary()</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/18/Tensorflow%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%BA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/18/Tensorflow%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%BA%8C/" class="post-title-link" itemprop="url">Tensorflowå­¦ä¹ ç¬”è®°(äºŒ)</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-02-18 19:23:12 / Modified: 20:48:59" itemprop="dateCreated datePublished" datetime="2021-02-18T19:23:12+08:00">2021-02-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ä½¿ç”¨å…«è‚¡æ­å»ºç¥ç»ç½‘ç»œ"><a href="#ä½¿ç”¨å…«è‚¡æ­å»ºç¥ç»ç½‘ç»œ" class="headerlink" title="ä½¿ç”¨å…«è‚¡æ­å»ºç¥ç»ç½‘ç»œ"></a>ä½¿ç”¨å…«è‚¡æ­å»ºç¥ç»ç½‘ç»œ</h1><p><strong>ç”¨Tensorflow APIï¼štf.kerasæ­å»ºç½‘ç»œå…«è‚¡</strong>   </p>
<p><strong>ğŸ±å…­æ­¥æ³•</strong></p>
<ul>
<li>importç›¸å…³æ¨¡å—   </li>
<li>ç¡®å®šè®­ç»ƒé›†å’Œæµ‹è¯•é›†<br>  æŒ‡å®šè®­ç»ƒé›†çš„è¾“å…¥ç‰¹å¾å’Œæ ‡ç­¾ï¼›<br>  æŒ‡å®šæµ‹è¯•é›†çš„è¾“å…¥ç‰¹å¾å’Œæ ‡ç­¾ã€‚   </li>
<li>åœ¨<code>Sequential()</code>ä¸­æ­å»ºç½‘ç»œç»“æ„ï¼Œé€å±‚æè¿°æ¯å±‚ç½‘ç»œ<br>  ç›¸å½“äºèµ°ä¸€éå‰å‘ä¼ æ’­   </li>
<li>åœ¨<code>compile()</code>ä¸­é…ç½®è®­ç»ƒæ–¹æ³•<br>  å‘ŠçŸ¥è®­ç»ƒæ—¶é€‰æ‹©å“ªç§ä¼˜åŒ–å™¨ï¼›<br>  é€‰æ‹©å“ªç§æŸå¤±å‡½æ•°ï¼›<br>  é€‰æ‹©å“ªç§è¯„æµ‹æŒ‡æ ‡ï¼›   </li>
<li>åœ¨<code>fit()</code>ä¸­æ‰§è¡Œè®­ç»ƒè¿‡ç¨‹<br>  å‘ŠçŸ¥è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„è¾“å…¥ç‰¹å¾å’Œæ ‡ç­¾ï¼›<br>  æ¯ä¸ªbatchæ˜¯å¤šå°‘ï¼›<br>  è¿­ä»£å¤šå°‘æ¬¡è®­ç»ƒé›†ï¼›  </li>
<li>ç”¨<code>summary()</code>æ‰“å°å‡ºç½‘ç»œçš„ç»“æ„å’Œå‚æ•°ç»Ÿè®¡  </li>
</ul>
<h2 id="Sequential"><a href="#Sequential" class="headerlink" title="Sequential()"></a>Sequential()</h2><pre><code># æè¿°ä»è¾“å…¥å±‚åˆ°è¾“å‡ºå±‚ï¼Œæ¯ä¸€å±‚çš„ç½‘ç»œç»“æ„
âœ¨model = tf.keras.models.Sequential([ç½‘ç»œç»“æ„])     

# æ¯ä¸€å±‚çš„ç½‘ç»œç»“æ„ï¼Œå¯ä»¥æ˜¯ğŸ‘‡  

#æ‹‰ç›´å±‚  
#è¯¥å±‚ä¸å«è®¡ç®—ï¼Œåªæ˜¯å½¢çŠ¶è½¬æ¢
#æŠŠè¾“å…¥ç‰¹å¾æ‹‰ç›´å˜æˆä¸€ç»´æ•°ç»„
tf.keras.layers.Flatten()


#å…¨è¿æ¥å±‚  
tf.keras.layers.Dense(ç¥ç»å…ƒä¸ªæ•°,activation=&apos;æ¿€æ´»å‡½æ•°&apos;,kernel_regularizer=é‚£ç§æ­£åˆ™åŒ–)   
#activation(ä»¥å­—ç¬¦ä¸²å½¢å¼ç»™å‡º)å¯é€‰: reluã€softmaxã€sigmoidã€tanh   
#kernel_regularizer å¯é€‰: tf.keras.regularizers.l1()ã€tf.keras.regularizers.l2()   

#å·ç§¯å±‚  
tf.keras.layers.Conv2D(filters=å·ç§¯æ ¸ä¸ªæ•°,kernel_size=å·ç§¯æ ¸å°ºå¯¸,strides=å·ç§¯æ­¥é•¿,padding=&quot;valid&quot;or&quot;same&quot;)    


#LSTMå±‚(å¾ªç¯ç¥ç»ç½‘ç»œå±‚)  
tf.keras.layers.LSTM()</code></pre><h2 id="compile"><a href="#compile" class="headerlink" title="compile()"></a>compile()</h2><pre><code>âœ¨model.complie(optimizer=ä¼˜åŒ–å™¨,loss=æŸå¤±å‡½æ•°,metrics=[&quot;å‡†ç¡®ç‡&quot;])



#ä¼˜åŒ–å™¨optimizerå¯ä»¥æ˜¯å­—ç¬¦ä¸²å½¢å¼ç»™å‡ºçš„ğŸ‘‡   
&gt;&gt;&apos;sgd&apos; or tf.keras.optimizers.SGD(lr=å­¦ä¹ ç‡,momentum=åŠ¨é‡å‚æ•°) 

&gt;&gt;&apos;adagrad&apos; pr tf.keras.optimizers.Adagrad(lr=*)

&gt;&gt;&apos;adadelta&apos; or tf.keras.optimizers.Adadelta(lr=*)   



#æŸå¤±å‡½æ•°lossğŸ‘‡   
&gt;&gt;&apos;mse&apos; or tf.keras.losses.MeanSquaredError()  

&gt;&gt;&apos;sparse_categorical_crossentropy&apos; or tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False)  
#ğŸ‘†è¿™ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯åœ¨è¯¢é—®æ˜¯å¦åŸå§‹è¾“å‡ºï¼›
#ç¥ç»ç½‘ç»œé¢„æµ‹ç»“æœè¾“å‡ºå‰ç»è¿‡æ¦‚ç‡åˆ†å¸ƒï¼Œå°±ä¸æ˜¯åŸå§‹è¾“å‡ºï¼Œæ­¤æ—¶å°±æ˜¯False



#ç½‘ç»œè¯„æµ‹æŒ‡æ ‡MetricsğŸ‘‡:  
&gt;&gt;&apos;accuracy&apos;:y_å’Œyéƒ½æ˜¯æ•°å€¼ï¼Œå¦‚y_=[1],y=[1]  

&gt;&gt;&apos;categorical_accuracy&apos;:y_å’Œyéƒ½æ˜¯ç‹¬çƒ­ç (æ¦‚ç‡åˆ†å¸ƒ),å¦‚y_=[0,1,0],y=[0.256,0.695,0.048] 

&gt;&gt;&apos;sparse_categorical_accuracy&apos;:y_æ˜¯æ•°å€¼ï¼Œyæ˜¯ç‹¬çƒ­ç (æ¦‚ç‡åˆ†å¸ƒ),å¦‚y_=[1],y=[0.256,0.695.0.048]   </code></pre><h2 id="fit"><a href="#fit" class="headerlink" title="fit()"></a>fit()</h2><pre><code>âœ¨model.fit(è®­ç»ƒé›†çš„è¾“å…¥ç‰¹å¾,è®­ç»ƒé›†çš„æ ‡ç­¾,batch_size= , epochs= ,validation_data=(æµ‹è¯•é›†çš„è¾“å…¥ç‰¹å¾,æµ‹è¯•é›†çš„æ ‡ç­¾),validation_split=ä»è®­ç»ƒé›†åˆ’åˆ†å¤šå°‘æ¯”ä¾‹ç»™æµ‹è¯•é›†,validation_freq=å¤šå°‘æ¬¡epochæµ‹è¯•ä¸€æ¬¡)   </code></pre><ul>
<li>validation_dataä¸validation_splitä¸¤è€…é€‰å…¶ä¸€  </li>
</ul>
<h2 id="model-summay"><a href="#model-summay" class="headerlink" title="model.summay()"></a>model.summay()</h2><p>æ‰“å°å‡ºç½‘ç»œçš„ç»“æ„å’Œå‚æ•°ç»Ÿè®¡<br><img src="https://i.loli.net/2021/02/18/1nCZIvTzxstSBQM.png" alt="image.png">   </p>
<h2 id="é¸¢å°¾èŠ±ç¤ºä¾‹"><a href="#é¸¢å°¾èŠ±ç¤ºä¾‹" class="headerlink" title="é¸¢å°¾èŠ±ç¤ºä¾‹"></a>é¸¢å°¾èŠ±ç¤ºä¾‹</h2><pre><code>import tensorflow as tf
from sklearn import datasets
import numpy as np

x_train = datasets.load_iris().data
y_train = datasets.load_iris().target

np.random.seed(116)
np.random.shuffle(x_train)
np.random.seed(116)
np.random.shuffle(y_train)
tf.random.set_seed(116)

model = tf.keras.models.Sequential([
    tf.keras.layers.Dense(3, activation=&apos;softmax&apos;, kernel_regularizer=tf.keras.regularizers.l2())
])

model.compile(optimizer=tf.keras.optimizers.SGD(lr=0.1),
            loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
            metrics=[&apos;sparse_categorical_accuracy&apos;])

model.fit(x_train, y_train, batch_size=32, epochs=500, validation_split=0.2, validation_freq=20)

model.summary()</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/27/%E9%B8%A2%E9%B8%9F%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/27/%E9%B8%A2%E9%B8%9F%E9%9B%86/" class="post-title-link" itemprop="url">é¸¢é¸Ÿé›†</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-27 20:52:42" itemprop="dateCreated datePublished" datetime="2021-01-27T20:52:42+08:00">2021-01-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-30 21:26:29" itemprop="dateModified" datetime="2021-01-30T21:26:29+08:00">2021-01-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ğŸå®ç°é¸¢å°¾èŠ±åˆ†ç±»æ•´ä½“æ€è·¯"><a href="#ğŸå®ç°é¸¢å°¾èŠ±åˆ†ç±»æ•´ä½“æ€è·¯" class="headerlink" title="ğŸå®ç°é¸¢å°¾èŠ±åˆ†ç±»æ•´ä½“æ€è·¯"></a>ğŸå®ç°é¸¢å°¾èŠ±åˆ†ç±»æ•´ä½“æ€è·¯</h1><h2 id="ğŸ‹å‡†å¤‡æ•°æ®"><a href="#ğŸ‹å‡†å¤‡æ•°æ®" class="headerlink" title="ğŸ‹å‡†å¤‡æ•°æ®"></a>ğŸ‹å‡†å¤‡æ•°æ®</h2><ul>
<li>æ•°æ®é›†è¯»å…¥</li>
<li>æ•°æ®é›†ä¹±åº</li>
<li>ç”Ÿæˆè®­ç»ƒé›†å’Œæµ‹è¯•é›†</li>
<li>é…æˆï¼ˆè¾“å…¥ç‰¹å¾ã€æ ‡ç­¾ï¼‰å¯¹ï¼Œæ¯æ¬¡è¯»å…¥batch    </li>
</ul>
<h2 id="ğŸ‹æ­å»ºç½‘ç»œ"><a href="#ğŸ‹æ­å»ºç½‘ç»œ" class="headerlink" title="ğŸ‹æ­å»ºç½‘ç»œ"></a>ğŸ‹æ­å»ºç½‘ç»œ</h2><ul>
<li>å®šä¹‰ç¥ç»ç½‘ç»œä¸­æ‰€æœ‰å¯è®­ç»ƒå‚æ•°    </li>
</ul>
<h2 id="ğŸ‹å‚æ•°ä¼˜åŒ–"><a href="#ğŸ‹å‚æ•°ä¼˜åŒ–" class="headerlink" title="ğŸ‹å‚æ•°ä¼˜åŒ–"></a>ğŸ‹å‚æ•°ä¼˜åŒ–</h2><ul>
<li>åµŒå¥—å¾ªç¯è¿­ä»£ï¼Œwithç»“æ„æ›´æ–°å‚æ•°ï¼Œæ˜¾ç¤ºå½“å‰loss   </li>
</ul>
<h2 id="ğŸ‹æµ‹è¯•æ•ˆæœ"><a href="#ğŸ‹æµ‹è¯•æ•ˆæœ" class="headerlink" title="ğŸ‹æµ‹è¯•æ•ˆæœ"></a>ğŸ‹æµ‹è¯•æ•ˆæœ</h2><ul>
<li>è®¡ç®—å½“å‰å‚æ•°å‰åä¼ æ’­åçš„å‡†ç¡®ç‡ï¼Œæ˜¾ç¤ºå½“å‰acc  </li>
</ul>
<h2 id="ğŸ‹acc-losså¯è§†åŒ–"><a href="#ğŸ‹acc-losså¯è§†åŒ–" class="headerlink" title="ğŸ‹acc/losså¯è§†åŒ–"></a>ğŸ‹acc/losså¯è§†åŒ–</h2><h1 id="ğŸå‡†å¤‡"><a href="#ğŸå‡†å¤‡" class="headerlink" title="ğŸå‡†å¤‡"></a>ğŸå‡†å¤‡</h1><h2 id="ğŸ‹æ•°æ®é›†è¯»å…¥"><a href="#ğŸ‹æ•°æ®é›†è¯»å…¥" class="headerlink" title="ğŸ‹æ•°æ®é›†è¯»å…¥"></a>ğŸ‹æ•°æ®é›†è¯»å…¥</h2><p>ä»<code>sklearn.datasets</code>ä¸­å¯ä»¥å¾—åˆ°é¸¢é¸Ÿçš„æ•°æ®åŒ…<br>ä¹Ÿå°±æ˜¯ï¼Œé¦–å…ˆè¦æœ‰<code>sklearn</code>åŒ…,é€šè¿‡<code>pip instal sklearn</code>è·å¾—</p>
<pre><code>from sklearn.datasets import load_iris
from pandas import DataFrame  #å¤„ç†æ•°æ®ï¼Œå½¢æˆè¡¨æ ¼ï¼Œæ›´ç›´è§‚
import pandas as pd

x_data = load_iris().data
y_data = load_iris().target
#è·å¾—ç‰¹å¾å’Œå¯¹åº”çš„æ ‡ç­¾

x_data = DataFrame(x_data, columns=[&apos;èŠ±è¼é•¿åº¦&apos;, &apos;èŠ±è¼å®½åº¦&apos;, &apos;èŠ±ç“£é•¿åº¦&apos;, &apos;èŠ±ç“£å®½åº¦&apos;]) # ä¸ºè¡¨æ ¼å¢åŠ è¡Œç´¢å¼•ï¼ˆå·¦ä¾§ï¼‰å’Œåˆ—æ ‡ç­¾ï¼ˆä¸Šæ–¹ï¼‰
pd.set_option(&apos;display.unicode.east_asian_width&apos;, True)  # è®¾ç½®åˆ—åå¯¹é½

x_data[&apos;ç±»åˆ«&apos;] = y_data  # æ–°åŠ ä¸€åˆ—ï¼Œåˆ—æ ‡ç­¾ä¸ºâ€˜ç±»åˆ«â€™ï¼Œæ•°æ®ä¸ºy_data

print(x_data)</code></pre><p><img src="https://i.loli.net/2021/01/27/u1WnPpVtriXq9Gj.png" alt="ç»“æœ"></p>
<h2 id="ğŸ±å…³äºDataFrame"><a href="#ğŸ±å…³äºDataFrame" class="headerlink" title="ğŸ±å…³äºDataFrame"></a>ğŸ±å…³äºDataFrame</h2><h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><p>åˆ›å»ºä¸€ä¸ªDataFrameï¼Œç›¸å½“äºè¿™ä¸€å †æ•°æ®å°±æ˜¯ä¸€ä¸ªè¡¨æ ¼ï¼Œåˆ›å»ºæ—¶ï¼Œä¼šé»˜è®¤ç»™æ–°å¢ä¸€åˆ—åœ¨æœ€å·¦ä¾§ï¼Œæ˜¯ç´¢å¼•ï¼Œä»0å¼€å§‹ï¼›<br>å¦‚æœæ•°æ®æ˜¯å­—å…¸å‹ï¼Œåˆ™å·²ç»ç¡®å®šå¥½äº†åˆ—åã€‚<br>è‹¥æ˜¯æ•°ç»„ï¼Œåˆ™å¯é€šè¿‡<code>columns=[]</code>æ¥å‘½åå„åˆ—ã€‚<br><img src="https://i.loli.net/2021/01/27/LOs6ztbnkuYgAPx.png" alt="ä¾‹å­"></p>
<h3 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h3><p>åˆ›å»ºä¹‹åï¼Œå°±æ˜¯ä¸€ä¸ªå¯æ“ä½œçš„DataFrame<br>åˆ™è‹¥è¦æ–°å¢ä¸€åˆ—(æœ€åä¸€åˆ—)ï¼Œå¯ç›´æ¥<code>x[&#39;åˆ—å&#39;]=[å†…å®¹]</code>ã€‚<br>è‹¥è¦æŒ‡å®šæ’å…¥ä¸€åˆ—<code>x.insert(æ’å…¥åæ‰€å¤„çš„åˆ—æ•°ï¼Œåˆ—åï¼Œå†…å®¹)</code><br><img src="https://i.loli.net/2021/01/27/AJx4Sdse9h2w1VU.png" alt="image.png"></p>
<h3 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h3><p><strong>åˆ—</strong><br>å¯ç›´æ¥<code>x[åˆ—å]</code><br>å½“ç„¶å¯ç›´æ¥é€šè¿‡æ­¤èµ‹å€¼<code>x[åˆ—å]=[å†…å®¹]</code><br><strong>è¡Œ</strong><br>ç›´æ¥<code>x.loc[&#39;è¡Œå&#39;]</code>   </p>
<p><strong>è¡Œå’Œåˆ—</strong>  </p>
<pre><code>x.iloc[:,:]   
#å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å‡ è¡Œï¼Œç¬¬äºŒä¸ªæ˜¯å‡ åˆ—ã€‚
#æ³¨æ„ï¼Œéƒ½æ˜¯ä»0è®¡æ•°ä¸”å‰é—­åå¼€ </code></pre><p><img src="https://i.loli.net/2021/01/27/InPzHicRCvDZMyS.png" alt="image.png"></p>
<h3 id="ç´¢å¼•è¡¥å……"><a href="#ç´¢å¼•è¡¥å……" class="headerlink" title="ç´¢å¼•è¡¥å……"></a>ç´¢å¼•è¡¥å……</h3><p>ç´¢å¼•é™¤äº†æœ€å¼€å§‹åœ¨åˆ›å»ºæ—¶åˆ›å»ºä»¥å¤–ï¼Œåœ¨åˆ›å»ºåä¹Ÿå¯ä»¥æ›´æ”¹ã€‚   </p>
<ol>
<li><p>å°†è‡ªå·±çš„ä¸€åˆ—è®¾ç½®ä¸ºç´¢å¼•<code>x.set_index([åˆ—å],drop=True)</code><br>dropé»˜è®¤æ˜¯Trueï¼Œæ„æ€æ˜¯ï¼Œå°†è¯¥åˆ—ä½œä¸ºç´¢å¼•åï¼Œä¸ä¿å­˜è¯¥åˆ—æ•°æ®ï¼›æ”¹ä¸ºFalseï¼Œåˆ™ä¿å­˜è¯¥åˆ—æ•°æ®ã€‚<br><img src="https://i.loli.net/2021/01/27/jksDGTqL9dFHhWa.png" alt="image.png"></p>
</li>
<li><p>ç›´æ¥åˆ›å»º<code>x.index=[1,2,3,4,5]</code></p>
</li>
<li><p>è¿˜åŸæˆé»˜è®¤å€¼<code>x.reset_index(drop=False)</code><br>dropé»˜è®¤å€¼æ˜¯Falseï¼Œæ˜¯æŒ‡å°†åŸæ¥çš„ç´¢å¼•å€¼ä¿ç•™ä¸ºæ•°æ®ï¼›è‹¥ä¸ºTrueï¼Œåˆ™åŸç´¢å¼•å€¼åˆ é™¤ã€‚<br><img src="https://i.loli.net/2021/01/27/TbaqnWCr7gHPOLl.png" alt="image.png"></p>
</li>
</ol>
<h2 id="ğŸ‹æ•°æ®é›†ä¹±åº"><a href="#ğŸ‹æ•°æ®é›†ä¹±åº" class="headerlink" title="ğŸ‹æ•°æ®é›†ä¹±åº"></a>ğŸ‹æ•°æ®é›†ä¹±åº</h2><pre><code>np.random.seed(116) #æ˜¯ç”¨ç›¸åŒçš„seedï¼Œä½¿è¾“å…¥ç‰¹å¾/æ ‡ç­¾ä¸€ä¸€å¯¹åº”
np.random.shuffle(x_data)
np.random.seed(116)
np.random.shuffle(y_data)
tf.random.set_seed(116)</code></pre><h2 id="ğŸ‹åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†"><a href="#ğŸ‹åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†" class="headerlink" title="ğŸ‹åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†"></a>ğŸ‹åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†</h2><pre><code>x_train = x_data[:-30]
y_train = y_data[:-30]
x_test = x_data[-30:]
y_test = y_data[-30:]</code></pre><h2 id="ğŸ‹é…å¯¹"><a href="#ğŸ‹é…å¯¹" class="headerlink" title="ğŸ‹é…å¯¹"></a>ğŸ‹é…å¯¹</h2><pre><code>train_db = tf.data.Dataset.from_tensor_slices((x_trainm4,y_train)).batch(32)
test_db = tf.data.Dataset.from_tensor_slices((x_test,y_test)).batch(32)</code></pre><h1 id="ğŸæ­å»ºç½‘ç»œ"><a href="#ğŸæ­å»ºç½‘ç»œ" class="headerlink" title="ğŸæ­å»ºç½‘ç»œ"></a>ğŸæ­å»ºç½‘ç»œ</h1><pre><code>w1 = tf.Variable(tf.random.truncated_normal([4,3],stddev=0.1,seed=1))
b1 = tf.Variable(tf.random.truncated_normal([4,3],stddev=0.1,seed=1))

for epoch in range(epoch):
    for step,(x_train,y_train) in enumerate(train_db):
        with tf.GradientTape() as tape:
            y = tf.matmul(x_train, w1) + b1  # ç¥ç»ç½‘ç»œä¹˜åŠ è¿ç®—
            y = tf.nn.softmax(y)  # ä½¿è¾“å‡ºyç¬¦åˆæ¦‚ç‡åˆ†å¸ƒï¼ˆæ­¤æ“ä½œåä¸ç‹¬çƒ­ç åŒé‡çº§ï¼Œå¯ç›¸å‡æ±‚lossï¼‰
            y_ = tf.one_hot(y_train, depth=3)  # å°†æ ‡ç­¾å€¼è½¬æ¢ä¸ºç‹¬çƒ­ç æ ¼å¼ï¼Œæ–¹ä¾¿è®¡ç®—losså’Œaccuracy
            loss = tf.reduce_mean(tf.square(y_ - y))  # é‡‡ç”¨å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°mse = mean(sum(y-out)^2)
            loss_all += loss.numpy()  # å°†æ¯ä¸ªstepè®¡ç®—å‡ºçš„lossç´¯åŠ ï¼Œä¸ºåç»­æ±‚losså¹³å‡å€¼æä¾›æ•°æ®ï¼Œè¿™æ ·è®¡ç®—çš„lossæ›´å‡†ç¡®

            grads = tape.gradient(loss,[w1,b1])
            w.assign_sub(lr*grads[0])
            b1.assign_sub(lr*grads[1])
        print(&quot;Epoch{},loss:{}&quot;.format(epoch,loss_all/4))</code></pre><h1 id="ğŸè®¡ç®—å‡†ç¡®ç‡"><a href="#ğŸè®¡ç®—å‡†ç¡®ç‡" class="headerlink" title="ğŸè®¡ç®—å‡†ç¡®ç‡"></a>ğŸè®¡ç®—å‡†ç¡®ç‡</h1><pre><code>for x_test,y_test in test_db:
    y = tf.matul(h,w)+b  #é¢„æµ‹ç»“æœ
    y = tf.nn.softmax(y)  #yç¬¦åˆæ¦‚ç‡åˆ†å¸ƒ  
    pred = tf.argmax(y,axis=1) #è¿”å›yä¸­æœ€å¤§å€¼çš„ç´¢å¼•ï¼Œå³é¢„æµ‹çš„åˆ†ç±»  
    pred = tf.cast(pred,dtype = y_test.dtype) #è°ƒæ•´æ•°æ®ç±»å‹ä¸æ ‡ç­¾ä¸€è‡´  
    correct = tf.cast(tf.equal(pred,y_test),dtype = tf.int32)
    correct = tf.reduce_sum(correct) $å°†æ¯ä¸ªbatchçš„correctæ•°åŠ èµ·æ¥
    total_correct +=int(correct)  #å°†æ‰€æœ‰batchä¸­çš„correctæ•°åŠ èµ·æ¥  
    total_number += x_test.shape[0]
acc = total_correct/total_number
print(&quot;test_acc:&quot;,acc)

plt.title(&quot;Acc Curve&quot;)
plt.xlabel(&quot;Epoch&quot;)
plt.ylabel(&quot;Acc&quot;)
plt.plot(test_acc,label=&quot;$Accuracy$&quot;)  
plt.legend()
plt.show()</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/24/Tensorflow-Anaconda-Pycharm%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/24/Tensorflow-Anaconda-Pycharm%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">Tensorflow+Anaconda+Pycharmç¯å¢ƒå®‰è£…</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-24 15:39:12" itemprop="dateCreated datePublished" datetime="2021-01-24T15:39:12+08:00">2021-01-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">40</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.1.1
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme â€“ <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
